{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2018-07-06/dragino-lorashield-node-configuration-for-AU915/","result":{"data":{"site":{"siteMetadata":{"title":"Thomas Laurenson"}},"markdownRemark":{"id":"3691f525-308f-5f3a-851b-0879f20c1e08","excerpt":"Update: This tutorial is now considered out-of-date. I have written a new tutorial which uses a more recent version of the Arduino-LMIC library modified by MCCI…","html":"<p><strong>Update: This tutorial is now considered out-of-date. I have written a new tutorial which uses a more recent version of the <em>Arduino-LMIC</em> library</strong> modified by MCCI which has much better support for the AU915 frequency. Please view the updated <a href=\"/blog/2018-07-21/dragino-lorashield-on-AU915/\">Dragino LoRa Shield Node Configuration for AU915 (Updated)</a> post for more information.</p>\n<h2 id=\"contents\" style=\"position:relative;\"><a href=\"#contents\" aria-label=\"contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contents</h2>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#introduction\">Introduction</a></li>\n<li><a href=\"#quick-start\">Quick Start</a></li>\n<li><a href=\"#australian-and-new-zealand-frequencies\">Australian and New Zealand Frequencies</a></li>\n<li>\n<p><a href=\"#walkthrough\">Walkthrough</a></p>\n<ul>\n<li><a href=\"#hardware-overview\">Hardware Overview</a></li>\n<li><a href=\"#setup-arduino-ide\">Setup Arduino IDE</a></li>\n<li><a href=\"#download-repo-and-flash-arduino\">Download Repo and Flash Arduino</a></li>\n<li><a href=\"#lorawan-library-configuration\">LoRaWAN Library Configuration</a></li>\n<li><a href=\"#lmic-fork\">LMIC Fork</a></li>\n<li><a href=\"#arduino-sketch-for-dragino-lorashield\">Arduino sketch for Dragino LoRaShield</a></li>\n</ul>\n</li>\n<li><a href=\"#additional-resources\">Additional Resources</a></li>\n</ul>\n</div>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>The Dragino LoRaShield is a popular example of an easy to use development/prototype board for use in LoRaWAN networks. The Dragino LoRaShield is an Arduino shield that provides the ability to function as either a LoRaWAN node or a single channel LoRaWAN gateway. This documentation, and accompanying source code focus solely on creating a development LoRaWAN node. The specific purpose of this repository (and guide) is to provide an example of the Dragino LoRaShield device operating on the standardized LoRaWAN frequencies for Australia and New Zealand… specifically the 915 MHz to 930 MHz frequency, more commonly known as <em>AU915</em>.</p>\n<h2 id=\"quick-start\" style=\"position:relative;\"><a href=\"#quick-start\" aria-label=\"quick start permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Quick Start</h2>\n<ol>\n<li>Download the <a href=\"https://github.com/thomaslaurenson/Dragino_LoRaShield_Node_AU915/blob/master/README.md\">Dragino<em>LoRaShield</em>Node_AU915\n</a> as a zip file</li>\n<li>Add library to Arduino IDE using add a zip file functionality</li>\n<li>Plug in Arduino with a Dragino LoRaShield attached</li>\n<li>Optional: Edit source code <code class=\"language-text\">Dragino_LoRaShield_AU915.ino</code> file to send different output/add code for sensors etc.</li>\n<li>Select Upload to compile, then upload</li>\n<li>View device is functioning correctly by viewing serial output</li>\n<li>Done.</li>\n</ol>\n<h2 id=\"australian-and-new-zealand-frequencies\" style=\"position:relative;\"><a href=\"#australian-and-new-zealand-frequencies\" aria-label=\"australian and new zealand frequencies permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Australian and New Zealand Frequencies</h2>\n<p>To operate LoRaWAN in Australia and New Zealand, a device should use the radio frequencies specified by the LoRaWAN standard. This allows interoperation, as well as operating radio devices within the regulations specified by the government. The standardized LoRaWAN frequencies for Australia and New Zealand range from 915 MHz to 930 MHz frequency. In the world of LoRaWAN, this standardization is more commonly known as <em>AU915</em>. This information is documented in the official frequency plans: the LoRaWAN 1.0.2 Specification. More specifically, a companion document named <a href=\"https://www.scribd.com/document/337679415/LoRaWAN-Regional-Parameters-v1-0-20161012-1397-1\">LoRaWAN Regional Parameters</a> outlines the frequencies for use in different countries.</p>\n<p>AU915 allows for a total of 73 possible channels to use within the 915 MHz to 930 MHz frequency. Most LoRa networks in Australia seem to have made a consensus to only use a specific portion of this, that is, a specific band of channels in the frequency range. The consensus is: use of channels 8 to 15 on the AU915 specification. This is also known as AU915 sub-band 2. This band in the specification that is implemented in the TTN server source code and is documented and distributed in the <a href=\"https://github.com/TheThingsNetwork/gateway-conf/blob/master/AU-global_conf.json\">global_conf.json</a> gateway configuration file distributed by TTN. Furthermore, the TTN community has specified the AU915 frequencies and channels on their <a href=\"https://www.thethingsnetwork.org/wiki/LoRaWAN/Frequencies/Frequency-Plans\">LoRaWAN Frequencies</a> page. Therefore, this makes the channel choice logical for this project, as we want a legal and standardized LoRaWAN solution.</p>\n<p>The entire point of the task is to get the Dragino LoRaShield to operate in the specified AU915 frequency range, and specifically, sub-band 2. Therefore, it is first prudent to document the required channels and their respective properties. The table below displays the available upstream and downstream channels for AU915 sub-band 2.</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Channel</th>\n<th align=\"center\">Direction</th>\n<th align=\"center\">Frequency (MHz)</th>\n<th align=\"center\">Bandwidth (kHz)</th>\n<th align=\"center\">Data Rate</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">8</td>\n<td align=\"center\">up</td>\n<td align=\"center\">916.8</td>\n<td align=\"center\">125</td>\n<td align=\"center\">DR0 - DR3</td>\n</tr>\n<tr>\n<td align=\"center\">9</td>\n<td align=\"center\">up</td>\n<td align=\"center\">917.0</td>\n<td align=\"center\">125</td>\n<td align=\"center\">DR0 - DR3</td>\n</tr>\n<tr>\n<td align=\"center\">10</td>\n<td align=\"center\">up</td>\n<td align=\"center\">917.2</td>\n<td align=\"center\">125</td>\n<td align=\"center\">DR0 - DR3</td>\n</tr>\n<tr>\n<td align=\"center\">11</td>\n<td align=\"center\">up</td>\n<td align=\"center\">917.4</td>\n<td align=\"center\">125</td>\n<td align=\"center\">DR0 - DR3</td>\n</tr>\n<tr>\n<td align=\"center\">12</td>\n<td align=\"center\">up</td>\n<td align=\"center\">917.6</td>\n<td align=\"center\">125</td>\n<td align=\"center\">DR0 - DR3</td>\n</tr>\n<tr>\n<td align=\"center\">13</td>\n<td align=\"center\">up</td>\n<td align=\"center\">917.8</td>\n<td align=\"center\">125</td>\n<td align=\"center\">DR0 - DR3</td>\n</tr>\n<tr>\n<td align=\"center\">14</td>\n<td align=\"center\">up</td>\n<td align=\"center\">918.0</td>\n<td align=\"center\">125</td>\n<td align=\"center\">DR0 - DR3</td>\n</tr>\n<tr>\n<td align=\"center\">15</td>\n<td align=\"center\">up</td>\n<td align=\"center\">918.2</td>\n<td align=\"center\">125</td>\n<td align=\"center\">DR0 - DR3</td>\n</tr>\n<tr>\n<td align=\"center\">65</td>\n<td align=\"center\">up</td>\n<td align=\"center\">917.5</td>\n<td align=\"center\">500</td>\n<td align=\"center\">DR4</td>\n</tr>\n<tr>\n<td align=\"center\">0</td>\n<td align=\"center\">down</td>\n<td align=\"center\">923.3</td>\n<td align=\"center\">500</td>\n<td align=\"center\">DR8 - DR13</td>\n</tr>\n<tr>\n<td align=\"center\">1</td>\n<td align=\"center\">down</td>\n<td align=\"center\">923.9</td>\n<td align=\"center\">500</td>\n<td align=\"center\">DR8 - DR13</td>\n</tr>\n<tr>\n<td align=\"center\">2</td>\n<td align=\"center\">down</td>\n<td align=\"center\">924.5</td>\n<td align=\"center\">500</td>\n<td align=\"center\">DR8 - DR13</td>\n</tr>\n<tr>\n<td align=\"center\">3</td>\n<td align=\"center\">down</td>\n<td align=\"center\">925.1</td>\n<td align=\"center\">500</td>\n<td align=\"center\">DR8 - DR13</td>\n</tr>\n<tr>\n<td align=\"center\">4</td>\n<td align=\"center\">down</td>\n<td align=\"center\">925.7</td>\n<td align=\"center\">500</td>\n<td align=\"center\">DR8 - DR13</td>\n</tr>\n<tr>\n<td align=\"center\">5</td>\n<td align=\"center\">down</td>\n<td align=\"center\">926.3</td>\n<td align=\"center\">500</td>\n<td align=\"center\">DR8 - DR13</td>\n</tr>\n<tr>\n<td align=\"center\">6</td>\n<td align=\"center\">down</td>\n<td align=\"center\">926.9</td>\n<td align=\"center\">500</td>\n<td align=\"center\">DR8 - DR13</td>\n</tr>\n<tr>\n<td align=\"center\">7</td>\n<td align=\"center\">down</td>\n<td align=\"center\">927.5</td>\n<td align=\"center\">500</td>\n<td align=\"center\">DR8 - DR13</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"walkthrough\" style=\"position:relative;\"><a href=\"#walkthrough\" aria-label=\"walkthrough permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Walkthrough</h2>\n<p>This section covers a complete and thorough walkthrough for installing an AU915 sketch onto an Arduino shield and operation of an attached Dragino LoRaShield. A <em>Windows 10 environment</em> is used for the walkthrough. However, the same process can easily be achieved on Linux, however, some of the instructions will vary.</p>\n<h3 id=\"hardware-overview\" style=\"position:relative;\"><a href=\"#hardware-overview\" aria-label=\"hardware overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hardware Overview</h3>\n<p>The <a href=\"http://www.dragino.com/products/module/item/102-lora-shield.html\">Dragino LoRaShield</a> is an affordable Arduino shield for prototype development of LoRaWAN devices. The device is excellent for a prototype node. The version used in this project in the US900 version - however, this device is not specifically supported for the AU915 specification. A photo of the device is included below for reference. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 390px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/43af761bbb85372eafebaee07587e89a/e52b6/Lora_Shield_v1.4.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85.44303797468356%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAMEAQIF/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAEDAv/aAAwDAQACEAMQAAABtY3pZp2kRztxDJgH/8QAGhAAAwEBAQEAAAAAAAAAAAAAAQIDAAQhMv/aAAgBAQABBQK3X7HoIUVU6vNijMZQCJh9b//EABYRAQEBAAAAAAAAAAAAAAAAAAERIP/aAAgBAwEBPwECY//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EAB0QAAIBBAMAAAAAAAAAAAAAAAABEQIDMVEgYZH/2gAIAQEABj8CdNlS9kVy+zI3b8EqVGyHnh//xAAbEAEAAwADAQAAAAAAAAAAAAABABEhEDGRQf/aAAgBAQABPyFCi+LMIUHTZCsPs0+rVuMSinxKoX2Xjs4//9oADAMBAAIAAwAAABD4P0D/xAAZEQACAwEAAAAAAAAAAAAAAAAAARARITH/2gAIAQMBAT8Q0ujoUf/EABgRAAIDAAAAAAAAAAAAAAAAAAARARAh/9oACAECAQE/EJbNv//EAB8QAQABAwQDAAAAAAAAAAAAAAERACExEEFRYYGx8P/aAAgBAQABPxBoKW8Prlp5BARllzY24q2h2ketqgSRbdG38NWIrJz0aHzpkLn4pxrP/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Dragino LoraShield v1.4\"\n        title=\"Dragino LoraShield v1.4\"\n        src=\"/static/43af761bbb85372eafebaee07587e89a/e52b6/Lora_Shield_v1.4.jpg\"\n        srcset=\"/static/43af761bbb85372eafebaee07587e89a/ff44c/Lora_Shield_v1.4.jpg 158w,\n/static/43af761bbb85372eafebaee07587e89a/a6688/Lora_Shield_v1.4.jpg 315w,\n/static/43af761bbb85372eafebaee07587e89a/e52b6/Lora_Shield_v1.4.jpg 390w\"\n        sizes=\"(max-width: 390px) 100vw, 390px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Attaching the LoRaWAN shield to an Arduino is a very simple process. Just plug the shield into the matching pins available. Plug and play! </p>\n<p><strong>NOTE:</strong> Make sure you have the US900 version of the Dragino LoRaShield. The version information is available on the bottom of the PCB board. A box on the PCB should be ticked to illustrate the specific model.</p>\n<h3 id=\"setup-arduino-ide\" style=\"position:relative;\"><a href=\"#setup-arduino-ide\" aria-label=\"setup arduino ide permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup Arduino IDE</h3>\n<p>Download and install the Arduino IDE. <a href=\"https://www.arduino.cc/en/Guide/Windows\">These instructions for installation on Windows</a> should provide enough information.</p>\n<h3 id=\"download-repo-and-flash-arduino\" style=\"position:relative;\"><a href=\"#download-repo-and-flash-arduino\" aria-label=\"download repo and flash arduino permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Download Repo and Flash Arduino</h3>\n<p>This repo and the library can be added to the Arduino IDE library using a variety of methods. These are outlined below:</p>\n<ol>\n<li>Clone this git repository into your sketchbook/libraries folder. In Windows the specific directory is <code class=\"language-text\">C:\\Users\\&lt;username>\\My Documents\\Arduino\\libraries\\&lt;library folder></code></li>\n<li>Install it using the Arduino Library manager (“Sketch” -> “Include Library” -> “Manage Libraries…“)</li>\n<li>Download a zip file from GitHub using the “Download ZIP” button and install it using the Arduino IDE (“Sketch” -> “Include Library” -> “Add .ZIP Library…“)</li>\n</ol>\n<p>For more information on using Arduino libraries, see <a href=\"https://www.arduino.cc/en/Guide/Libraries\">https://www.arduino.cc/en/Guide/Libraries</a>.</p>\n<p>Now we want to open the <code class=\"language-text\">Dragino_LoRaShield_AU915.ino</code> sketch file in the Arduino IDE. The sketch file is available in the <code class=\"language-text\">/examples</code> directory in this repo. This specific sketch file is a modified version of the original sketch provided with the Dragino LoRaShield provided on <a href=\"http://wiki.dragino.com/index.php?title=Lora_Shield\">the Dragino Wiki</a> for the US900 version, available directly from <a href=\"https://github.com/dragino/Lora/blob/master/Lora%20Shield/Examples/lora_shield_ttn-915-fix-frequency/lora_shield_ttn-915-fix-frequency.ino\">here</a>.</p>\n<p>Make sure your Arduino and LoRaShield are attached to the host computer via USB. Now, upload the sketch to Arduino, by selecting “Upload” which will compile and upload the sketch to the device.</p>\n<p>Finally, open serial monitor so we can view output from the device and ensure it is functioning correctly. Set the serial monitor baud to 115200. You should see output similar to that below:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">Starting\nPacket queued for freq: 916800000\n132794: EV_TXCOMPLETE (includes waiting for RX windows)\nPacket queued for freq: 917000000\n1515422: EV_TXCOMPLETE (includes waiting for RX windows)\nPacket queued for freq: 917200000\n2898055: EV_TXCOMPLETE (includes waiting for RX windows)\nPacket queued for freq: 917400000\n4280688: EV_TXCOMPLETE (includes waiting for RX windows)\nPacket queued for freq: 917600000\n5663319: EV_TXCOMPLETE (includes waiting for RX windows)\nPacket queued for freq: 917800000\n7045951: EV_TXCOMPLETE (includes waiting for RX windows)\nPacket queued for freq: 918000000\n8428658: EV_TXCOMPLETE (includes waiting for RX windows)\nPacket queued for freq: 918200000\n9811291: EV_TXCOMPLETE (includes waiting for RX windows)\nPacket queued for freq: 916800000\n11193937: EV_TXCOMPLETE (includes waiting for RX windows)</code></pre></div>\n<p>In the output, you should see packets queued for sending on 8 specific channels. Each channel is displayed as the frequency used when sending a packet. The node should send a packet, then the channel should either: 1) Move to the next channel; or 2) If at the end of the channel list, jump back to the first channel. In the listing above, packets started sending on channel 8 (916.8 MHz) and cycled through the remaining 7 channels before looping back to channel 8 again.</p>\n<h3 id=\"lorawan-library-configuration\" style=\"position:relative;\"><a href=\"#lorawan-library-configuration\" aria-label=\"lorawan library configuration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LoRaWAN Library Configuration</h3>\n<p>For the sake of complete documentation, this section summarises the changes made to the original source code used in this project. To reiterate, two sources were used to create the required files for this project:</p>\n<ol>\n<li><a href=\"https://github.com/matthijskooijman/arduino-lmic\">Fork of the LMIC project modified for use on Arduinos</a></li>\n<li><a href=\"https://github.com/dragino/Lora/blob/master/Lora%20Shield/Examples/lora_shield_ttn-915-fix-frequency/lora_shield_ttn-915-fix-frequency.ino\">Arduino sketch (.ino file) for the LoRaShield provide by Dragino</a></li>\n</ol>\n<p>A summary of changes to the source code are:</p>\n<ol>\n<li>Modify the LMIC fork to use the US915 frequency</li>\n<li>Modify the LMIC fork US915 frequency to adhere to the AU915 standard</li>\n<li>Modify the LMIC fork disableChannel() function to use the correct channel step</li>\n<li>Modify the Arduino sketch to disable the correct channels (to only enable band 2 in AU915)</li>\n</ol>\n<p>The changes made are more thoroughly documented in the following subsections.</p>\n<h3 id=\"lmic-fork\" style=\"position:relative;\"><a href=\"#lmic-fork\" aria-label=\"lmic fork permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LMIC Fork</h3>\n<p>The LMIC library used in this project is a pre-existing fork of the IMB LoRaMAC-in-C. To quote the original author: the fork is <em>the IBM LMIC (LoraMAC-in-C) library, slightly modified to run in the Arduino environment, allowing using the SX1272, SX1276 transceivers and compatible modules.</em> This section outlines the modifications to the library that have been made. Firstly, all modification have been made in the src folder, and sub-folder named lmic, as documented below:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">Dragino_LoRaShield_Node_AU915/src/lmic</code></pre></div>\n<p>In <code class=\"language-text\">config.h</code> comment out line 8:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">//#define CFG_eu868 1</span></code></pre></div>\n<p>In <code class=\"language-text\">config.h</code> uncomment line 9:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CFG_us915</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span></code></pre></div>\n<p>This change specified that we should use the US915 specification. However, even though we just changed the frequency to US915 we will not use this specification… we just hijacked this definition for ease of implementation. Therefore, we need to update the ecisting US915 MHz code for the AU915 specification. In the <code class=\"language-text\">lorabase.h</code> file, change lines 117 to 126 to:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">enum</span> <span class=\"token punctuation\">{</span> US915_125kHz_UPFBASE <span class=\"token operator\">=</span> <span class=\"token number\">915200000</span><span class=\"token punctuation\">,</span>\n       US915_125kHz_UPFSTEP <span class=\"token operator\">=</span>    <span class=\"token number\">200000</span><span class=\"token punctuation\">,</span>\n       US915_500kHz_UPFBASE <span class=\"token operator\">=</span> <span class=\"token number\">915900000</span><span class=\"token punctuation\">,</span>\n       US915_500kHz_UPFSTEP <span class=\"token operator\">=</span>   <span class=\"token number\">1600000</span><span class=\"token punctuation\">,</span>\n       US915_500kHz_DNFBASE <span class=\"token operator\">=</span> <span class=\"token number\">923300000</span><span class=\"token punctuation\">,</span>\n       US915_500kHz_DNFSTEP <span class=\"token operator\">=</span>    <span class=\"token number\">600000</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">enum</span> <span class=\"token punctuation\">{</span> US915_FREQ_MIN <span class=\"token operator\">=</span> <span class=\"token number\">915000000</span><span class=\"token punctuation\">,</span>\n       US915_FREQ_MAX <span class=\"token operator\">=</span> <span class=\"token number\">928000000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The above code sets a new minimum (915000000) and maximum (928000000) frequency to match the AU915 band 2 standard.</p>\n<p>Now, we need to also make a small change in the <code class=\"language-text\">lmic.c</code> file. Change lines 776 to 779, from:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">LMIC_disableChannel</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">u1_t</span> channel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>    \n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> channel <span class=\"token operator\">&lt;</span> <span class=\"token number\">72</span><span class=\"token operator\">+</span>MAX_XCHANNELS <span class=\"token punctuation\">)</span>        \n    LMIC<span class=\"token punctuation\">.</span>channelMap<span class=\"token punctuation\">[</span>channel<span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;=</span> <span class=\"token operator\">~</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">&lt;&lt;</span><span class=\"token punctuation\">(</span>channel<span class=\"token operator\">&amp;</span><span class=\"token number\">0xF</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>to:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">LMIC_disableChannel</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">u1_t</span> channel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> channel <span class=\"token operator\">&lt;</span> <span class=\"token number\">72</span><span class=\"token operator\">+</span>MAX_XCHANNELS <span class=\"token punctuation\">)</span>        \n    LMIC<span class=\"token punctuation\">.</span>channelMap<span class=\"token punctuation\">[</span>channel<span class=\"token operator\">/</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;=</span> <span class=\"token operator\">~</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">&lt;&lt;</span><span class=\"token punctuation\">(</span>channel<span class=\"token operator\">&amp;</span><span class=\"token number\">0xF</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>All done! That was all the changes required to the LMIC Arduino port to get the Dragino LoRaShield working in the AU915 standard.</p>\n<h3 id=\"arduino-sketch-for-dragino-lorashield\" style=\"position:relative;\"><a href=\"#arduino-sketch-for-dragino-lorashield\" aria-label=\"arduino sketch for dragino lorashield permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Arduino sketch for Dragino LoRaShield</h3>\n<p>The script in this project was derived from the original Dragino LoRaShield sketch provided on the Dragino Wiki. The sketch required a variety of modifications. However, the most important modification is the selection of channels. The sketch initializes the LoRaWAN chip on the shield and enables all channels by default. The snippet of code below demonstrates how to use a simple for loop to disable specific channels (0-7 and 16-72). Ultimately, this only leaves the AU915 band 2 channels enabled, that is, channels 8-15. The code modification if documented below:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// First, disable channels 0-7</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> channel<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> channel<span class=\"token operator\">&lt;</span><span class=\"token number\">8</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>channel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">LMIC_disableChannel</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Now, disable channels 16-72</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> channel<span class=\"token operator\">=</span><span class=\"token number\">16</span><span class=\"token punctuation\">;</span> channel<span class=\"token operator\">&lt;</span><span class=\"token number\">72</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>channel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token function\">LMIC_disableChannel</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// This means only channels 8-15 are up</span></code></pre></div>\n<h2 id=\"additional-resources\" style=\"position:relative;\"><a href=\"#additional-resources\" aria-label=\"additional resources permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Additional Resources</h2>\n<ol>\n<li><a href=\"http://www.instructables.com/id/Use-Lora-Shield-and-RPi-to-Build-a-LoRaWAN-Gateway/\">http://www.instructables.com/id/Use-Lora-Shield-and-RPi-to-Build-a-LoRaWAN-Gateway/</a></li>\n<li><a href=\"http://wiki.dragino.com/index.php?title=Lora_Shield\">http://wiki.dragino.com/index.php?title=Lora_Shield</a></li>\n<li><a href=\"https://www.thethingsnetwork.org/forum/t/ttn-australian-communities/4068/10\">https://www.thethingsnetwork.org/forum/t/ttn-australian-communities/4068/10</a></li>\n<li><a href=\"https://www.thethingsnetwork.org/forum/t/lmic-node-dropped-packets/4400/9\">https://www.thethingsnetwork.org/forum/t/lmic-node-dropped-packets/4400/9</a></li>\n</ol>","frontmatter":{"title":"Dragino LoRaShield Node Configuration for AU915 MHz","date":"July 06, 2018","tags":["IoT","LoRaWAN","AU915"],"description":"Tutorial for the Dragino LoRaShield Node Configuration for Australian and New Zealand Frequencies (AU915 MHz).","thumbnail":"lorawan.png"}},"previous":{"fields":{"slug":"/blog/2018-07-05/building-an-ubuntu-linux-gateway/"},"frontmatter":{"title":"Building an Ubuntu Linux Gateway"}},"next":{"fields":{"slug":"/blog/2018-07-07/how-to-reset-and-revert-git-commits/"},"frontmatter":{"title":"How to Reset and Revert Git Commits"}}},"pageContext":{"id":"3691f525-308f-5f3a-851b-0879f20c1e08","previousPostId":"2ab309a1-e047-50bd-85f9-cbf147b9ac37","nextPostId":"98717890-4a81-58c8-a3d7-8185c6e1c3c2"}},"staticQueryHashes":["1771194231","2841359383","3880320062"]}