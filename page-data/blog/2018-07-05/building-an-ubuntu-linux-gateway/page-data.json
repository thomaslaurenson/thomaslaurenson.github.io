{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2018-07-05/building-an-ubuntu-linux-gateway/","result":{"data":{"site":{"siteMetadata":{"title":"Thomas Laurenson"}},"markdownRemark":{"id":"2ab309a1-e047-50bd-85f9-cbf147b9ac37","excerpt":"This post documents how to build a Linux gateway using Ubuntu Server 18.04. The gateway connects an internal network to an external network - basicallyâ€¦","html":"<p>This post documents how to build a Linux gateway using Ubuntu Server 18.04. The gateway connects an internal network to an external network - basically, performing Network Address Translation (NAT) for hosts on the internal network. It is exceptionally similar to what your ISP supplied home router does. To achieve this, an Ubuntu Linux server is configured as a DHCP server and also to provide NAT using <code class=\"language-text\">iptables</code>. </p>\n<h2 id=\"contents\" style=\"position:relative;\"><a href=\"#contents\" aria-label=\"contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contents</h2>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#introduction\">Introduction</a></li>\n<li><a href=\"#configure-network-interface-cards\">Configure Network Interface Cards</a></li>\n<li><a href=\"#install-dhcp-server\">Install DHCP server</a></li>\n<li><a href=\"#configure-network-address-translation\">Configure Network Address Translation</a></li>\n<li><a href=\"#configuring-internal-hosts-linux\">Configuring Internal Hosts: Linux</a></li>\n<li><a href=\"#configuring-internal-hosts-windows\">Configuring Internal Hosts: Windows</a></li>\n<li><a href=\"#check-network-connectivity\">Check Network Connectivity</a></li>\n</ul>\n</div>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>This tutorial is written when building a blueprint for VMWare vRealize, but the instructions lend to any virtualization, or normal, system. The <em>gateway</em> connects to an external network named <em>vlan25</em>Profile_ which provides Internet access, and a second network, <em>InternalNetwork</em>, which is an isolated network. While <em>host1</em> only connects to the <em>InternalNetwork</em>. The vRealize blueprint for the network is displayed below.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a47d7328ca7c9c358aecb5b88783d589/966a0/blueprint.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.36708860759494%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABN0lEQVQoz4WS626DMAyFef833P50SIWVQkO45A49s01BBY1Nwkry4ZzYJ8mm6YmzmJ8AfTJP07zj8wxh75wjOxNLaYbWGlV1h/ee1hNiTDK2rUbf95S3sBin/wU50TkHYwzNIwklhJA2vhzCB0RhfwtSTyFEiiBiPLLAwpb1yla+E0yHYOZ9hHfhsDmc8lVHBNngNda18w5F9YnL5Qt5nqMoChGz3uJ6+9h4WZbwrwpFMJD5hk50zsNaj0im881F8sfYAeX3DYouwRgn/5iPxJXSdDkd5Sx8a9mQ0bUeoNuWElox2splsPEJzUOh6wepjjdzMGfWD6Pw0VjqKIj3WUfVXRsF1TS417V4YmkTJ3MiV8HVjKPFMBgJ5kq1UjnPOddShyLo6Q2Nh5Z3EV/xG3+b87vlln8A/yUMfiJfdQMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vRealize blueprint\"\n        title=\"vRealize blueprint\"\n        src=\"/static/a47d7328ca7c9c358aecb5b88783d589/f058b/blueprint.png\"\n        srcset=\"/static/a47d7328ca7c9c358aecb5b88783d589/c26ae/blueprint.png 158w,\n/static/a47d7328ca7c9c358aecb5b88783d589/6bdcf/blueprint.png 315w,\n/static/a47d7328ca7c9c358aecb5b88783d589/f058b/blueprint.png 630w,\n/static/a47d7328ca7c9c358aecb5b88783d589/966a0/blueprint.png 944w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"configure-network-interface-cards\" style=\"position:relative;\"><a href=\"#configure-network-interface-cards\" aria-label=\"configure network interface cards permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configure Network Interface Cards</h2>\n<p>The server only has one primary requirement: two Network Interface Cards (NICs). Start by listing the NICs that are available on the system:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">ls /sys/class/net/</code></pre></div>\n<p>If one, or no, NICs are present more need to be added in the hardware configuration for the virtual machine. In the case of a normal machine, one or two physical NICs are required. Another example of the network architecture is displayed below. This time, the NIC interface names have been supplied:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/24282ebf373a6e616506a2f7342bf1f4/966a0/network_interfaces.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.36708860759494%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABWklEQVQoz4WSi07CMBSGef9nM2iCMaKRDFymbGXdrfeN33NaRwYJmuxkp3/b79y6Gscz7tl0BuiLfhinK32aELWlzra6BwthQtM0OB5LWGtpPcL7EP9SNui6js4lzfvxfyAfNMZAKUW+J1CAc+GipyAcwEftbyDV5JwncxHGfwYkLa1nbdavgOHGGGitg9H2cjFlxb4nn4F2AXWYORHIDZ4tRQJccDiedsiyDHmeUy+/E8xqfFUfOBw+sd9nKIoC9jfDCHTUfEURjbHQlBE3mKdYVgLrxwfsdhm2b+/YbJ5TZtSC1+0L1usnGloLpQ18WAxFUaOrpkcjJU1PxkYzvGk71LJFVZ0gxIkudxiUpiEZ2utRlgJdP8SsWTdcNmWyailqLmrUQlBWVeyJpqj9oCJYUhZsmnzW+l7FSlir6fkwjMG8H4GWShyWJfN7i2/uxsKN+Wuf3y2X/AONjAomgyHdUQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vRealize blueprint with network interface names\"\n        title=\"vRealize blueprint with network interface names\"\n        src=\"/static/24282ebf373a6e616506a2f7342bf1f4/f058b/network_interfaces.png\"\n        srcset=\"/static/24282ebf373a6e616506a2f7342bf1f4/c26ae/network_interfaces.png 158w,\n/static/24282ebf373a6e616506a2f7342bf1f4/6bdcf/network_interfaces.png 315w,\n/static/24282ebf373a6e616506a2f7342bf1f4/f058b/network_interfaces.png 630w,\n/static/24282ebf373a6e616506a2f7342bf1f4/966a0/network_interfaces.png 944w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Now we know the names of the two NICs, we can edit the networking configuration file. Open the interfaces file using the <code class=\"language-text\">vim</code> editor, or another text editor of your choice (e.g., <code class=\"language-text\">nano</code>):</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sudo vim /etc/network/interfaces</code></pre></div>\n<p>In the following instructions, the two NICs that will be configured are <code class=\"language-text\">ens160</code> and <code class=\"language-text\">ens192</code>. The <code class=\"language-text\">ens160</code> NIC is connected to the outside world and will receive an IP address configuration from an external DHCP server. The <code class=\"language-text\">ens192</code> NIC is the internal interface that is connected to the same network that the internal hosts are on. Given the preceding network setup, the following configuration is specified:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">auto ens160\niface ens160 inet dhcp\n\nauto ens192\niface ens192 inet static\n    address 192.168.100.10\n    netmask 255.255.255.0\n    gateway 192.168.100.1</code></pre></div>\n<p>Restart networking on the system so that the new configuration is applied:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sudo systemctl restart networking</code></pre></div>\n<h2 id=\"install-dhcp-server\" style=\"position:relative;\"><a href=\"#install-dhcp-server\" aria-label=\"install dhcp server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install DHCP server</h2>\n<p>We are going to use Dynamic Host Configuration Protocol (DHCP) to supply IP addresses to any host on the internal network. Install the default package supplied by the Ubuntu repositories:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sudo apt install isc-dhcp-server</code></pre></div>\n<p>Edit the server configuration file:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sudo vim /etc/default/isc-dhcp-server</code></pre></div>\n<p>The only change required here is to put the internal (<code class=\"language-text\">ens192</code>) interface in the file:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">INTERFACES=\"ens192\"</code></pre></div>\n<p>Now, edit the DHCP configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sudo vim /etc/dhcp/dhcpd.conf</code></pre></div>\n<p>Add the following configuration for the DHCP server. </p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">option domain-name-servers 8.8.8.8, 8.8.8.4;\n\noption subnet-mask 255.255.255.0;\noption broadcast-address 192.168.100.255;\nsubnet 192.168.100.0 netmask 255.255.255.0 {\nrange 192.168.100.20 192.168.100.100;\noption routers 192.168.100.10;\n}</code></pre></div>\n<p>A good resource for DHCP options is the <a href=\"https://linux.die.net/man/5/dhcp-options\">dhcp-options man page from die.net</a>. The first line of the configuration above specifies DNS settings. This allows translation of computer-friendly IP addresses to human-friendly domain names; for example: <code class=\"language-text\">google.com</code> corresponds to <code class=\"language-text\">172.217.25.142</code>. If you want, you can specify a <code class=\"language-text\">domain-name</code> option as well, but this is not required. However, make sure to include the <code class=\"language-text\">domain-name-servers</code> option with valid IP addresses from DNS servers. You can use the free Google DNS server using the value <code class=\"language-text\">8.8.8.8</code> or <code class=\"language-text\">8.8.8.4</code>, or use any other DNS server that you wish.</p>\n<p>The remaining options specified above are for IP address allocation. This configuration is for the IP range <code class=\"language-text\">192.168.100.0\\24</code>, or from <code class=\"language-text\">192.168.100.0</code> to <code class=\"language-text\">192.168.100.254</code>. The <code class=\"language-text\">range</code> option specifies the range of addresses to provide for lease, in this case, it is limited to 80 addresses, from <code class=\"language-text\">192.168.100.20</code> to <code class=\"language-text\">192.168.100.100</code>. This can be modified to suit. Finally, the <code class=\"language-text\">routers</code> option, specifies the address of the <em>gateway</em> machine, which has a static IP address of <code class=\"language-text\">192.168.100.10</code>. The <code class=\"language-text\">routers</code> option has the IP address of the <em>gateway</em> because this is the machine that forwards traffic from the internal network to external networks.</p>\n<p>Save the file, then restart service:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sudo service isc-dhcp-server restart</code></pre></div>\n<h2 id=\"configure-network-address-translation\" style=\"position:relative;\"><a href=\"#configure-network-address-translation\" aria-label=\"configure network address translation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configure Network Address Translation</h2>\n<p>Enable IPv4 forwarding:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sudo vim /etc/sysctl.conf</code></pre></div>\n<p>Uncomment the following line:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">net.ipv4.ip_forward=1</code></pre></div>\n<p>Check forwarding worked using:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sysctl net.ipv4.ip_forward\nOR\ncat /proc/sys/net/ipv4/ip_forward</code></pre></div>\n<p>Add a NAT forwarding rule using <code class=\"language-text\">iptables</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sudo iptables -t nat -A POSTROUTING -o ens160 -j MASQUERADE</code></pre></div>\n<p>Save the <code class=\"language-text\">iptables</code> configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sudo apt install iptables-persistent\nsudo su\nsudo iptables-save > /etc/iptables/rules.v4\nexit</code></pre></div>\n<p>Ensure the rules load at boot:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">vim /etc/rc.local </code></pre></div>\n<p>Add the following line:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">/sbin/iptables-restore < /etc/iptables/rules.v4</code></pre></div>\n<h2 id=\"configuring-internal-hosts-linux\" style=\"position:relative;\"><a href=\"#configuring-internal-hosts-linux\" aria-label=\"configuring internal hosts linux permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configuring Internal Hosts: Linux</h2>\n<p>With the gateway setup to provide DHCP and NAT services, a Linux host on the internal network can be configured to acquire an IP address from the gateway, and have all traffic routed through the gateway. The only configuration required on a Linux client is to edit the network configuration file and set the NIC of the client to DHCP.</p>\n<p>List the NICs that are available on the system:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">ls /sys/class/net/</code></pre></div>\n<p>Open the network interfaces file:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">vim /etc/network/interfaces</code></pre></div>\n<p>In the following instructions, the NICs on the Linux client is named <code class=\"language-text\">ens160</code>. Configure the NIC to receive an IP address from the gateway:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">auto ens160\niface ens160 inet dhcp</code></pre></div>\n<p>Make sure to restart the networking service to make sure the new configuration is applied:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sudo systemctl restart networking</code></pre></div>\n<h2 id=\"configuring-internal-hosts-windows\" style=\"position:relative;\"><a href=\"#configuring-internal-hosts-windows\" aria-label=\"configuring internal hosts windows permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configuring Internal Hosts: Windows</h2>\n<p>A full tutorial on configuring DHCP is beyond the scope of this post. Instead, I recommend checking out the <a href=\"https://support.microsoft.com/en-nz/help/15089/windows-change-tcp-ip-settings\">excellent tutorial provided by Microsoft</a> that covers how to configure a NIC for DHCP in Windows 10, 8.1, and 7. When configured you can open a Command Prompt and use the following command to check the configuration is working.</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">ipconfig</code></pre></div>\n<h2 id=\"check-network-connectivity\" style=\"position:relative;\"><a href=\"#check-network-connectivity\" aria-label=\"check network connectivity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Check Network Connectivity</h2>\n<p>The overall network configuration is completed and hosts should be able to get IP addresses from the gateway DHCP server. Furthermore, the gateway will forward any traffic from the hosts to the outside world (Internet) and have DNS support. A summary of the IP addresses for each machine and NIC is displayed in the figure below:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0a82bb509364dd70b53c5e110ef249ed/7e509/network_configuration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.06329113924051%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABmElEQVQoz11S7W6bQBD0+79T+reJlKSuI7VN1dQpsWxQcAwHHPcF07k9sHGQhltGy+zs7a58GBGI5TOOE6bYh+GcwxDeDwlhwhTHnFV8hWHEZvOEr7d3OBwKaN2jaTpUlULTdiJknUdZfsBadym6LE5cBImHh0fcUvDHz19Yf9/w+xvW6w3u7x+xff2H48cJNzdf8Pz8G/t9jpeXv9huX5G97fCHcZ4XGOh+NbfsfKCLhN5YtF1Htwe6rNHSpSMf2FZZHtmBFqeGedZ6nk5OcTgLxrYvAAt4ijjej2flQQrG75lLCOLq/N/yDufWEwZx4GysbAXOeYHwbuYdBa8NXRwSy7jrWtR1RSiilrb6XjM+QQlXyfCiw+V/1y2L6CBJjT4i222RZW8oioKuBmjbYJ9n5HYcQg7dGwxjWqMrwarrU1WlKBhgbLrkuDq1amRlokNjvfBKtTKk5TDOLVuq78oTJ7qX0Rtj2K6GalrBO6cazygeEcUiJzF5rc3V/a8cW2x7K6sQ7yROLk00ITpw0zp95iJi/lLwP5CwVRBd+2JZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vRealize blueprint with network configuration\"\n        title=\"vRealize blueprint with network configuration\"\n        src=\"/static/0a82bb509364dd70b53c5e110ef249ed/f058b/network_configuration.png\"\n        srcset=\"/static/0a82bb509364dd70b53c5e110ef249ed/c26ae/network_configuration.png 158w,\n/static/0a82bb509364dd70b53c5e110ef249ed/6bdcf/network_configuration.png 315w,\n/static/0a82bb509364dd70b53c5e110ef249ed/f058b/network_configuration.png 630w,\n/static/0a82bb509364dd70b53c5e110ef249ed/7e509/network_configuration.png 745w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>You can check the DHCP leases on the <em>gateway</em> machine using the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">cat /var/lib/dhcp/dhcpd.leases</code></pre></div>\n<p>From <em>host1</em>, or any other hosts on the internal network, it would be useful to check the connectivity by first pinging the DHCP allocated address:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">ping 192.168.100.20</code></pre></div>\n<p>Then ping the IP address of the gateway internal-facing interface:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">ping 192.168.100.10</code></pre></div>\n<p>Then finish it off with pinging any Internet DNS name:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">ping google.com</code></pre></div>\n<p>If all these tests pass, the configuration was successful!</p>","frontmatter":{"title":"Building an Ubuntu Linux Gateway","date":"July 05, 2018","tags":["Networking","Ubuntu","Linux","Tutorial"],"description":"Building a Linux Gateway using Ubuntu Server 18.04.","thumbnail":"ubuntu.png"}},"previous":{"fields":{"slug":"/blog/2018-07-04/metasploitable3-customizing-the-ubuntu-linux-version/"},"frontmatter":{"title":"Metasploitable3 - Customizing the Ubuntu Linux Version"}},"next":{"fields":{"slug":"/blog/2018-07-06/dragino-lorashield-node-configuration-for-AU915/"},"frontmatter":{"title":"Dragino LoRaShield Node Configuration for AU915 MHz"}}},"pageContext":{"id":"2ab309a1-e047-50bd-85f9-cbf147b9ac37","previousPostId":"725599b7-51a8-54ed-ba69-464fa51571fb","nextPostId":"3691f525-308f-5f3a-851b-0879f20c1e08"}},"staticQueryHashes":["1771194231","2841359383","3880320062"]}