{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2018-07-03/metasploitable3-building-the-ubuntu-linux-version/","result":{"data":{"site":{"siteMetadata":{"title":"Thomas Laurenson"}},"markdownRemark":{"id":"b307e159-e6ad-5ec3-a739-3bb5138e9fb4","excerpt":"This post is part of a series on the Ubuntu Linux version of Metasploitable3. The following posts are part of the series: Part 1: Building the Ubuntu Linux…","html":"<p>This post is part of a series on the Ubuntu Linux version of Metasploitable3. The following posts are part of the series:</p>\n<ul>\n<li>Part 1: <a href=\"/blog/2018-07-03/metasploitable3-building-the-ubuntu-linux-version/\">Building the Ubuntu Linux Version</a> (You are here!)</li>\n<li>Part 2: <a href=\"/blog/2018-07-04-metasploitable3-customizing-the-ubuntu-linux-version\">Customizing the Ubuntu Linux Version</a></li>\n<li>Part 3: <a href=\"/blog/2018-07-08/metasploitable3-pentesting-the-ubuntu-linux-version-part1\">Pentesting the Ubuntu Linux Version - SQL Injection</a></li>\n<li>Part 4: <a href=\"/blog/2018-07-09/metasploitable3-pentesting-the-ubuntu-linux-version-part2\">Pentesting the Ubuntu Linux Version - Attacking Services</a></li>\n</ul>\n<h2 id=\"contents\" style=\"position:relative;\"><a href=\"#contents\" aria-label=\"contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contents</h2>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#introduction\">Introduction</a></li>\n<li><a href=\"#metasploitable2-metasploitable3-and-infosec-assignments\">Metasploitable2, Metasploitable3 and InfoSec Assignments</a></li>\n<li>\n<p><a href=\"#building-the-metasploitable3-linux-version\">Building the Metasploitable3 Linux Version</a></p>\n<ul>\n<li><a href=\"#install-application-requirements-dependencies\">Install Application Requirements (Dependencies)</a></li>\n<li><a href=\"#building-metasploitable3-linux-version\">Building Metasploitable3 Linux Version</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>Metasploitable3 is an intentionally vulnerable machine build for exploit testing (aka. pen testing). Back in November, 2016, <a href=\"https://blog.rapid7.com/2016/11/15/test-your-might-with-the-shiny-new-metasploitable3/\">Rapid7</a> released Metasploitable3. I had used the previous version, <a href=\"https://metasploit.help.rapid7.com/docs/metasploitable-2\">Metasploitable2</a>, to learn the basics of penetration testing. It was an excellent platform for exploratory testing, and I was sure Metasploitable3 was going to be the same experience… it was!</p>\n<h2 id=\"metasploitable2-metasploitable3-and-infosec-assignments\" style=\"position:relative;\"><a href=\"#metasploitable2-metasploitable3-and-infosec-assignments\" aria-label=\"metasploitable2 metasploitable3 and infosec assignments permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Metasploitable2, Metasploitable3 and InfoSec Assignments</h2>\n<p>In my first semester of teaching Introduction to Information Security in Semester 1, 2017, I used Metasploitable2 for in-class practical lab exercises. I did the same again this year. For the first assignment in the paper, students have to perform an information security audit and document all findings in a security audit report. It is a fun assignment! Last year, I choose Metasploitable3 in the hopes that they wouldn’t find out what system they were auditing. I went to great lengths to ensure there was no trace of the phrase <em>Metasploitable3</em> in the system. I am pretty sure it went un-noticed! This year I was looking for something new, and I accidentally stumbled across Metasploitable3… the Linux version! It’s an exciting story, but in summary, I was building the Windows Server 2008 version on Linux and noticed the BASH script was expecting an argument…</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">case \"$1\" in\n    ubuntu1404)  echo \"building ubuntu 1404\"\n                 os_full=\"ubuntu_1404\"\n                 os_short=\"ub1404\"\n                 ;;\n    windows2008) echo \"building windows 2008\"\n                 os_full=\"windows_2008_r2\"\n                 os_short=\"win2k8\"\n                 ;;\nesac</code></pre></div>\n<p>A sense of great interest filled my heart. I had just re-read the <a href=\"https://github.com/rapid7/metasploitable3/wiki\">Metasploitable3 Wiki</a>, perused over the <a href=\"https://github.com/rapid7/metasploitable3\">source code on the GitHub repository</a> and had seen nothing about a Linux version. I checked the first <a href=\"https://blog.rapid7.com/2016/11/15/test-your-might-with-the-shiny-new-metasploitable3/\">Rapid7 blog post</a> about Metasploitable3 and noticed the following statement:</p>\n<blockquote>\n<blockquote>\n<p>Although our first image is Windows, the planning part of the Linux version has already begun. If you would like to jump on this train, please feel free to leave a comment on Github, or contribute.</p>\n</blockquote>\n</blockquote>\n<p>A bit of further digging revealed a <a href=\"https://github.com/rapid7/metasploitable3/issues/37\">GitHub issue</a> was opened by a user named prateepb who stated that they’d be happy to create a Linux version. There was a bit of chatter back and forth, and even a post summarising a selection of tasty vulnerabilities for the system:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">SSH with weak passwords\nPHPMyAdmin [I'm currently working on this one locally]\nWebDAV (with PUT method enabled)\nProFTPD 1.3.5 (proftpd_modcopy_exec)\nApache Continuum 1.4.2 (apache_continuum_cmd_exec) > rapid7/metasploit-framework#6962\nVNC (vnc_keyboard_exec)\nCacti 0.8.8 (cacti_tree_sqli)\nSamba (samba_symlink_traversal)\nApache with mod_cgi (apache_mod_cgi_bash_env_exec)\nCups 1.7.2 (cups_bash_env_exec)\nJBoss AS 6.1.0.Final (JDK 6, 7)\nActionPack 4.2.4 (rails_actionpack_inline_exec)\nCustom PHP login page that's vulnerable to SQL injection\nSplunk 6.1.1 (splunk_upload_app_exec)\nMySQL binding 0.0.0.0\nUnreaIRCD IRC daemon (unreal_ircd_3281_backdoor)\nDrupal 7.5 (drupal_restws_exec)\nLinux kernel >=4.4 bpf_priv_esc\nDocker (docker_daemon_privilege_escalation)\nLinux Local CVE-2016-4997</code></pre></div>\n<p>Very recently, in February 2018, the user <a href=\"https://github.com/rapid7/metasploitable3/pull/231\">jbarnett-r7 submitted a push request on GitHub</a> to include the code for the Linux box that was used for the <a href=\"https://blog.rapid7.com/2017/12/11/congrats-to-the-winners-of-our-2017-community-ctf/\">capture the flag competition hosted by Rapid7</a> in December 2017. This addition was after I built the Metasploitable3 Linux version for my assignment.</p>\n<p>Even with the odds against me, I decided to use the Metapsploitable3 Linux version for my assignment. It was new and interesting, and I needed a challenge. Also, I luckily started planning the classes in advance so had the time to tinker and test!</p>\n<h2 id=\"building-the-metasploitable3-linux-version\" style=\"position:relative;\"><a href=\"#building-the-metasploitable3-linux-version\" aria-label=\"building the metasploitable3 linux version permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Building the Metasploitable3 Linux Version</h2>\n<p>The problem I initially faced was that there was no formal documentation about the Metasploitable3 Linux version. There was no information on building the Linux version, and no (robust) information about the vulnerabilities in the system. I am guessing that is because the build was (and seems to still be) in active development. This was in stark contrast to the Metasplotable3 Windows Server 2008 version, which is heavily documented on the <a href=\"https://github.com/rapid7/metasploitable3/wiki\">Rapid7 GitHub Wiki</a>. There are configuration instructions, tips and tricks and, most importantly, a list of vulnerabilities.</p>\n<p>The <a href=\"https://github.com/rapid7/metasploitable3/blob/master/README.md\">README.md</a> file from the Metasploitable3 repository has the most up-to-date information on building the system. They specify the following system requirements:</p>\n<ul>\n<li>OS capable of running all of the required applications listed below</li>\n<li>VT-x/AMD-V Supported Processor recommended</li>\n<li>65 GB Available space on the drive</li>\n<li>4.5 GB RAM</li>\n</ul>\n<p>In terms of the selected build operating system, the only requirement is that the system can run the applications listed in the next section. Technically, this could be achievable on Microsoft Windows, but building on Linux is much more sensible. This tutorial uses Ubuntu Desktop 18.04 amd64 LTS as the operating system. </p>\n<p>As usual, make sure your system is up-to-date by running the <code class=\"language-text\">update</code> and <code class=\"language-text\">upgrade</code> commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sudo apt update && sudo apt upgrade</code></pre></div>\n<p>Now it is time to install the application/tool dependencies.</p>\n<h3 id=\"install-application-requirements-dependencies\" style=\"position:relative;\"><a href=\"#install-application-requirements-dependencies\" aria-label=\"install application requirements dependencies permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install Application Requirements (Dependencies)</h3>\n<p>In addition to the system requirements specified above, the README file also specifies the following collection of package requirements:</p>\n<ul>\n<li>Packer</li>\n<li>Vagrant</li>\n<li>Vagrant Reload Plugin</li>\n<li>VirtualBox</li>\n<li>Internet connection</li>\n</ul>\n<p>When I started trying to build Metasploitable3, I ran into dependency issues. Specifically, I had problems with the versions of the tools I had installed. On a closer inspection of the <a href=\"https://github.com/rapid7/metasploitable3/blob/master/build.sh\">build.sh</a> script, I noticed there were a collection of variables that checked the tool requirement version numbers. A snippet of the code is displayed below:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">min_vbox_ver=\"5.1.10\"\nmin_vagrant_ver=\"1.9.0\"\nmin_packer_ver=\"0.10.0\"\nmin_vagrantreload_ver=\"0.0.1\"\npacker_bin=\"packer\"\npacker_build_path=\"packer/builds\"</code></pre></div>\n<p>The above tools were all marked as <em>minimum</em>, guessing that these were the minimum versions required to build Metasploitable3. The following instructions specify how I set up my build environment to match the above requirements.</p>\n<h4 id=\"installing-oracle-virtual-box\" style=\"position:relative;\"><a href=\"#installing-oracle-virtual-box\" aria-label=\"installing oracle virtual box permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installing Oracle Virtual Box</h4>\n<p><a href=\"https://www.virtualbox.org/\">VirtualBox</a> is an open source (GPLv2) x86/x64 virtualization product that runs on Windows, Linux, OS X, and Solaris systems. In this tutorial, it is used to host the virtualized guest operating system (Metasploitable3) while it is being built. </p>\n<p>In Ubuntu 18.04, VirtualBox is provided in the default <code class=\"language-text\">apt</code> repositories. This is a decent option to install as the application will be tested with Ubuntu and updates provided when a new stable version is added to the package repository. But you could install from the Debian package provided on the <a href=\"https://www.virtualbox.org/wiki/Linux_Downloads\">Download VirtualBox for Linux Hosts</a> page. This tutorial uses the package repository, which (at time of writing) provides version 5.2.10. You can search the package repository using the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">thomasl@server:~$ apt search virtualbox\n...\nvirtualbox/bionic-updates,now 5.2.10-dfsg-6ubuntu18.04.1 amd64\n  x86 virtualization solution - base binaries\n...</code></pre></div>\n<p>As specified in the Metasploitable3 README, VirtualBox version 5.1.10 or higher is required. You can install VirtualBox using the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">thomasl@server:~$ sudo apt install virtualbox</code></pre></div>\n<p>Once VirtualBox has been installed, check the version by running the <code class=\"language-text\">virtualbox</code> command and the <code class=\"language-text\">--help</code> option to confirm what version you are running:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">thomasl@server:~$ virtualbox --help\nOracle VM VirtualBox Manager 5.2.10_Ubuntu</code></pre></div>\n<p>One last step for VirtualBox. The Metasploitable3 project requires the VirtualBox Guest Additions. Again, this can easily be installed from the Ubuntu repositories using the <code class=\"language-text\">apt</code> command:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">thomasl@server:~$ sudo apt install virtualbox-guest-additions-iso</code></pre></div>\n<h4 id=\"installing-vagrant\" style=\"position:relative;\"><a href=\"#installing-vagrant\" aria-label=\"installing vagrant permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installing Vagrant</h4>\n<p>The second requirement for building Metasploitable3 is the vagrant tool. Developed by HashiCorp, <a href=\"https://www.vagrantup.com/\">Vagrant</a> is a tool for building and managing virtual machine environments which automates system configuration. We are going to use the Debian package provided by HashiCorp. </p>\n<p>We will start by moving into the <code class=\"language-text\">/tmp</code> directory, a good place for temporary files:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">thomasl@server:~$ cd /tmp</code></pre></div>\n<p>Now, download the Debian package. This tutorial uses Vagrant version 2.1.2. It would be worth checking if there is an updated Debian 64-bit package when you are building. Check the <a href=\"https://www.vagrantup.com/downloads.html\">Download Vagrant website</a> and use an updated URL if an update is available. Download Vagrant using the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">thomasl@server:/tmp$ wget https://releases.hashicorp.com/vagrant/2.1.2/vagrant_2.1.2_x86_64.deb</code></pre></div>\n<p>Install the Debian package using the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">thomasl@server:/tmp$ sudo dpkg -i vagrant_2.1.2_x86_64.deb</code></pre></div>\n<p>Make sure you check the install:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">thomasl@server:/tmp$ vagrant version\nInstalled Version: 2.1.2\nLatest Version: 2.1.2\n\nYou're running an up-to-date version of Vagrant!</code></pre></div>\n<h4 id=\"installing-packer\" style=\"position:relative;\"><a href=\"#installing-packer\" aria-label=\"installing packer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installing Packer</h4>\n<p>The third requirement for building Metasploitable3 is the <a href=\"https://www.packer.io/\">packer</a> tool. Again, this tool is produced by HashiCorp and is used to automates the creation of any type of machine image.</p>\n<p>There is only a binary available for packer, distributed in a zip archive. Now, download the Debian package. This tutorial uses Packer version 1.2.4. It would be worth checking if there is an updated version when you are building. Check the <a href=\"https://www.packer.io/downloads.html\">Download Packer website</a> and use an updated URL if an update is available. Download Packer using the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">thomasl@server:/tmp$ wget https://releases.hashicorp.com/packer/1.2.4/packer_1.2.4_linux_amd64.zip</code></pre></div>\n<p>Unzip the file. Note the <code class=\"language-text\">unzip</code> tool is provided by default in Ubuntu Desktop 18.04 but has not been in the past. If the following command does not work, make sure to install the <code class=\"language-text\">unzip</code> utility using: <code class=\"language-text\">sudo apt install unzip</code>. Not extract the zip archive:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">thomasl@server:/tmp$ unzip packer_1.2.4_linux_amd64.zip</code></pre></div>\n<p>The archive only contains one file, named <code class=\"language-text\">packer</code>. We need to make this binary file available. You could add a path, but that is a little more work, so we are going to move the <code class=\"language-text\">packer</code> binary file to the <code class=\"language-text\">/usr/local/bin/</code> directory. Basically, this means that we can run, or execute, the <code class=\"language-text\">packer</code> command from any location in the file system. Move the executable file using the command below:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">thomasl@server:/tmp$ mv packer /usr/local/bin/packer</code></pre></div>\n<p>If you ever want to remove the file in the future, just delete the file using: <code class=\"language-text\">sudo rm /usr/local/bin/packer</code>.</p>\n<p>Check that packer works and is the correct version using the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">thomasl@server:/tmp$ packer version\nPacker v1.2.4</code></pre></div>\n<h4 id=\"installing-packer-vagrant-reload-plugin\" style=\"position:relative;\"><a href=\"#installing-packer-vagrant-reload-plugin\" aria-label=\"installing packer vagrant reload plugin permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installing Packer Vagrant Reload Plugin</h4>\n<p>The fourth, and final requirement is a Vagrant plugin named <a href=\"https://github.com/aidanns/vagrant-reload\">vagrant-reload</a>. This plugin allows a reload during virtual machine provisioning. The Metasploitable3 build requires this plugin, so we must install it. Luckily, the installation is straightforward. Execute the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">thomasl@server:/tmp$ vagrant plugin install vagrant-reload\nInstalling the 'vagrant-reload' plugin. This can take a few minutes...\nFetching: vagrant-reload-0.0.1.gem (100%)\nInstalled the plugin 'vagrant-reload (0.0.1)'!</code></pre></div>\n<p>Done!</p>\n<h3 id=\"building-metasploitable3-linux-version\" style=\"position:relative;\"><a href=\"#building-metasploitable3-linux-version\" aria-label=\"building metasploitable3 linux version permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Building Metasploitable3 Linux Version</h3>\n<p>In the previous section, we install all application requirements including VirtualBox, Vagrant, vagrant-reload, and packer. We are now ready to actually build Metasploitable3! </p>\n<p>This tutorial specifies the home directory to download the GitHub repository and build the project. However, you can perform these steps in another location. It shouldn’t make a difference, as none of the commands specify a full path.</p>\n<p>Go back to your home directory, or somewhere you want to build the project:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">cd ~</code></pre></div>\n<p>Make sure you have <code class=\"language-text\">git</code> installed. This is required to download the source code of the Metasploitable3 project from GitHub. Use <code class=\"language-text\">apt</code> to install <code class=\"language-text\">git</code> if you do not already have it installed:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">sudo apt install git</code></pre></div>\n<p>Clone the Metasploitable3 GitHub repository:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">git clone https://github.com/rapid7/metasploitable3.git</code></pre></div>\n<p>It is approximately 175MB, so be patient! Now, change directory to the downloaded Metasploitable3 source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">cd metasploitable3</code></pre></div>\n<p><strong>BUG FIX</strong></p>\n<p>This step is very important. When building Metasploitable3 for this tutorial, I found a bug in the configuration for one of the flags… specifically, the <code class=\"language-text\">7_of_diamonds</code> flag. If the following bug fix is not implemented, your build will fail!</p>\n<p>Open the <code class=\"language-text\">flags.rb</code> file, where the configuration for the system flags is performed.</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">vim chef/cookbooks/metasploitable/recipes/flags.rb</code></pre></div>\n<p>Locate line 38. Basically, we need to change one of the lines which have an error. The specific flag is the <code class=\"language-text\">7_of_diamonds</code>, and the docker image that is built for this flag refers to an incorrect name. In the code, it is specified as <code class=\"language-text\">7 of diamonds</code>, while it should be <code class=\"language-text\">7_of_diamonds</code>. The original code is listed below:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">bash 'build docker image for 7 of diamonds' do\n  code <<-EOH\n    cd /opt/docker\n    docker build -t \"7_of_diamonds\" .\n    docker run -dit --restart always --name 7_of_diamonds 7_of_diamonds\n  EOH\nend</code></pre></div>\n<p>Make sure to change the code to the following listing (note the added underscore character to the first line!):</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">bash 'build docker image for 7_of_diamonds' do\n  code <<-EOH\n    cd /opt/docker\n    docker build -t \"7_of_diamonds\" .\n    docker run -dit --restart always --name 7_of_diamonds 7_of_diamonds\n  EOH\nend</code></pre></div>\n<p>OK! We are ready to start the build process. Run the build script using <code class=\"language-text\">ubuntu1404</code> as an argument to the script. This will specify that we want to build the Linux version, not the Windows Server 2008 version:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">./build.sh ubuntu1404</code></pre></div>\n<p>Get a coffee, do the dishes or find something else to do for the next 30 to 45 minutes. The build process takes quite a while, but due to the automated tools used (Vagrant and Packer), it requires no intervention from the user. </p>\n<p>When finished you will see output that is similar to the code snippet below. </p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">==> Builds finished. The artifacts of successful builds are:\n--> virtualbox-iso: 'virtualbox' provider box: /home/thomasl/metasploitable3/packer/templates/../builds/ubuntu_1404_virtualbox_0.1.12.box\nBox successfully built by Packer.\nAttempting to add the box to Vagrant...\n==> box: Box file was not detected as metadata. Adding it directly...\n==> box: Adding box 'metasploitable3-ub1404' (v0) for provider:\n    box: Unpacking necessary files from: file:///home/thomasl/metasploitable3/packer/builds/ubuntu_1404_virtualbox_0.1.12.box\n==> box: Successfully added box 'metasploitable3-ub1404' (v0) for 'virtualbox'!\nBox successfully added to Vagrant.\n---------------------------------------------------------------------\nSUCCESS: Run 'vagrant up' to provision and start metasploitable3.\nNOTE: The VM will need Internet access to provision properly.</code></pre></div>\n<p>The specific build will complete, resulting in a <code class=\"language-text\">.box</code> file. According to <a href=\"https://www.vagrantup.com/docs/boxes/format.html\">HashiCorp</a>, a <code class=\"language-text\">.box</code> file is is a compressed (<code class=\"language-text\">tar</code>, <code class=\"language-text\">tar.gz</code>, <code class=\"language-text\">zip</code>) file that is specific to a single provider (e.g., VirtualBox or VMWare) and can contain anything. In the case of Metasploitable3, it is the virtual machine that we just built. You can find the <code class=\"language-text\">.box</code> file in the <code class=\"language-text\">metasploitable3/packer/builds/</code> directory. </p>\n<p>To start the virtual machine, essentially exporting it to VirtualBox, run the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">vagrant up</code></pre></div>\n<p>This will export the <code class=\"language-text\">.box</code> file to VirtualBox. More specifically, we should probably run:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">vagrant up ub1404</code></pre></div>\n<p>The <code class=\"language-text\">vagrant up</code> command looks the <code class=\"language-text\">.Vagrantfile</code> in the base directory of the Metasploitable3 source code. If we have a look at the code in this file, we can see that running <code class=\"language-text\">vagrant up</code> will try to export both types of virtual machines (Ubuntu Linux and Widnows Server 2008). The Linux-specific part of the <code class=\"language-text\">.Vagrantfile</code> is displayed below:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">Vagrant.configure(\"2\") do |config|\n  config.vm.define \"ub1404\" do |ub1404|\n    ub1404.vm.box = \"metasploitable3-ub1404\"\n    ub1404.vm.hostname = \"metasploitable3-ub1404\"\n    config.ssh.username = 'vagrant'\n    config.ssh.password = 'vagrant'\n\n    ub1404.vm.network \"private_network\", ip: '172.28.128.3'\n\n    ub1404.vm.provider \"virtualbox\" do |v|\n      v.name = \"Metasploitable3-ub1404\"\n      v.memory = 2048\n    end\n  end\n\n  config.vm.define \"win2k8\" do |win2k8|\n    # Base configuration for the VM and provisioner\n    win2k8.vm.box = \"metasploitable3-win2k8\"\n...</code></pre></div>\n<p>As you can see, there are two configurations for each type of virtual machine. The <code class=\"language-text\">ub1404</code> configuration is for the virtual machine we just built. We can see some interesting configuration options including the name of the <code class=\"language-text\">.box</code> file (<code class=\"language-text\">metasploitable3-ub1404</code>), the hostname (<code class=\"language-text\">metasploitable3-ub1404</code>), the username and password (<code class=\"language-text\">vagrant/vagrant</code>), the IP address of the virtual machine (<code class=\"language-text\">172.28.128.3</code>), the name of the virtual machine (<code class=\"language-text\">Metasploitable3-ub1404</code>) and RAM allocation (<code class=\"language-text\">2048</code>). You can edit these values to change any configuration when the virtual machine is exported, or you can change these values through VirtualBox as well.</p>\n<p>After running <code class=\"language-text\">vagrant up</code> or <code class=\"language-text\">vagrant up ub1404</code>, the virtual machine will be exported and become available in VirtualBox. You can open the VirtualBox application and see that the <code class=\"language-text\">Metasploitable3-ub1404</code> virtual machine is running and available for use. Like previously mentioned, you can now easily customize the virtual machine using the VirtualBox application; for example, modify the network adapter configuration. </p>\n<p>Hopefully, this tutorial got a Metasploitable3 Ubuntu Linux version virtual machine up and running. The platform is excellent for testing and learning in a virtualized environment. Stay tuned for my next Metasploitable3 tutorial, customizing Metasploitable3 Ubuntu Linux version, where we will look at how to customize the vulnerabilities, users, and flags for the virtual machine we build today.</p>","frontmatter":{"title":"Metasploitable3 - Building the Ubuntu Linux Version","date":"July 03, 2018","tags":["Metasploitable3","Pentesting","Linux"],"description":"Tutorial on Building the Metasploitable3 Ubuntu Linux version.","thumbnail":"metasploitable3.png"}},"previous":{"fields":{"slug":"/blog/2018-07-02/better-bash-history/"},"frontmatter":{"title":"Better Bash History"}},"next":{"fields":{"slug":"/blog/2018-07-04/metasploitable3-customizing-the-ubuntu-linux-version/"},"frontmatter":{"title":"Metasploitable3 - Customizing the Ubuntu Linux Version"}}},"pageContext":{"id":"b307e159-e6ad-5ec3-a739-3bb5138e9fb4","previousPostId":"55f8da95-2948-5eac-8c5a-35c8cadbe300","nextPostId":"725599b7-51a8-54ed-ba69-464fa51571fb"}},"staticQueryHashes":["1771194231","2841359383","3880320062"]}